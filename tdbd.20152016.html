<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head><title>TDBD</title>








  

  
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8"></head><body style="color: rgb(0, 0, 0);" alink="#ee0000" link="#0000ee" vlink="#551a8b">
<h1>Construção de uma Base de Dados Relacional Dinâmica<br></h1>

<span style="font-weight: bold;">Desenvolvimento de
Aplicação de Gestão de Casas de Turismo</span><br>

<h2>Introdução</h2>

Este trabalho consiste na implementação de uma
Aplicação para Gestão de Casas de Turismo (AGCT).
Actualmente a informação necessária
para
várias actividades da AGCT
é mantida em ficheiros Excel.
Vários processos
de consolidação de informação requerem
cálculos e operações manuais de
copiar/colar, levando à inerente redundância de
informação e possíveis
erros nas operações devido ao factor humano. A AGCT a ser
desenvolvida
inclui vários componentes abaixo descritos que
pretendem automatizar e tornar mais coerentes as várias tarefas
que manipulam informação importante.<br>

<h2>Preparação</h2>

A aplicação é para ser desenvolvida de forma
integrada no software <a href="http://wordpress.org/">Wordpress</a>,
também usado pela como sistema gestor de
conteúdos online (<a href="http://en.wikipedia.org/wiki/Web_content_management_system">Content
Management System</a>).
O Wordpress é uma aplicação desenvolvida sobre
PHP+MySQL de forma a que
todos os conteúdos de um website ficam armazenados numa BD,
facilitando
actualizações, tanto dos conteúdos como do
próprio Wordpress. Um
aspecto central do desenvolvimento do TDBD é a
utilização do plugin <a href="http://bluesome.net/post/2005/08/18/50/">Exec-PHP</a>
que permite que posts/páginas do Wordpress executem
código PHP.
Nomeadamente, os componentes da AGCT serão
desenvolvidos
em páginas gravadas numa instalação do Wordpress
as quais irão conter referências a ficheiros contendo
todo o código PHP e SQL necessário. As grandes vantagens
desta abordagem é a rapidez e
facilidade
com que se organizam os vários componentes/subcomponentes, bem
como a
utilização de plugins/mecanismos/funcionalidades do
próprio Wordpress
para aumentar as capacidades da AGCT e também a
realização de
backups/restores.<br><br>Neste
sentido, utilizámos uma antigo computador, no qual instalámos e
configurámos o sistema operativo Ubuntu Server de modo a que este
pudesse ser utilizado como servidor Web, mais especificamente, criou-se
um servidor LAMP (Linux, Apache, MySQL, PHP) ao qual depois foi
adicionado e configurando o Wordpress. Após isso criámos também um
script PHP que é executado automaticamente pelo GitHub sempre que
efetuamos uma alteração ao código da aplicação, desta forma conseguimos
trabalhar de forma colaborativa e mais eficiente, sendo que todas as
alterações feitas ficam automaticamente disponíveis entre nós. A
utilização do GitHub como repositório de código tem também a vantagem
de ter a funcionalidade de controlo de versões que permite que caso
neessário possamos regredir as alterações que forem feitas.<br><br>Esse servidor está online e pode ser consultado recorrendo ao endereço <a href="http://agct16.ddns.net/">http://agct16.ddns.net/</a><br>

<br>Iremos utilizar os seguintes plugins do Wordpress:
<ol>

  <li>Capability Manager Enhanced (a ser usado mais tarde)<br>
  </li>
  <li>Exclude Pages (para excluir páginas do
público
geral)<br>
  </li>
  <li>Exec-PHP (já explicado acima)<br>
  </li>
  <li>My Page Order (para facilmente ordenar páginas criadas)</li>
  <li>PS Disable Auto Formatting (desactiva
auto-formatação do Wordpress, necessário para se
poder controlar completamente o output HTML realizado pelo Wordpress)</li>
</ol>Utilizaremos o tema&nbsp;<a href="https://wordpress.org/themes/responsive/">Responsive</a>
de modo a facilitar o trabalho que termos de executar ao nível de
front-end. Este tema como o próprio nome indica é Responsive ou seja
tem o cuidado de fazer com que a página Web se ajuste a todos os tipos
de ecrãs.<br><br>Cada
uma das componentes descritas de seguida terá correspondência a uma
página no Wordpress.&nbsp; Por exemplo, ao criar-se a página com
título <span style="font-weight: bold;">Gestão de entidades</span>, é automaticamente criado o "permalink" <span style="font-weight: bold;">http://agct16.ddns.net/gestao-de-entidades </span>onde fica acessível o respectivo componente. Criar as pastas <span style="font-weight: bold;">custom/php</span>
na pasta raiz do wordpress (i.e., <span style="font-weight: bold;">/var/www/html/custom/php</span>
e, para cada componente (por exemplo o <span style="font-weight: bold;">gestao-de-entidades</span>):<br>

<ul>

  <li>criar uma página no Wordpress com o nome do componente</li>
  <li>criar um ficheiro php na pasta <span style="font-weight: bold;">php</span>
também
com o mesmo nome</li>
  <li>colocar na respectiva página do Wordpress o
código: &lt;?php include("custom/php/<span style="font-weight: bold;">gestao-de-</span><span style="font-weight: bold;">entidades</span>)<span style="font-weight: bold;">.php</span>"); ?&gt;</li>
  <li>realizar a programação directamente no ficheiro php
criado<br></li></ul>



<h2>Regras/dicas a seguir</h2>

<h3>Configurações adicionais no Wordpress</h3>

<ul>

  <li>Para utilização de <span style="font-weight: bold;">variáveis
de sessão</span>,
é necessário (e obrigatório) incluir logo no
início (após a linha <span style="font-weight: bold;">&lt;?php</span>)
do ficheiro <span style="font-weight: bold;">wp-config.php</span> uma
linha com a
instrução <span style="font-family: monospace;">session_start();</span>
Para criar/utilizar
variáveis de sessão é só usar: <span style="font-weight: bold;">$_SESSION['nome_da_var']<br>
    </span></li>
  <ul>
    <li>Caso hajam problemas na utilização de
variáveis de sessão, tentar o seguinte para detectar o
erro:<br>
    </li>
    <ul>
      <li>echo da sessão depois de se obter o id da
função mysql_insert_id().<br>
      </li>
      <li>echo antes da transacção para se ver o que tem
dentro da sessão.<br>
      </li>
      <li>certificar que o nome da sessão é o mesmo nos
dois locais: $_SESSION['id']<br>
      </li>
      <li>certificar que NÃO está ser feito o unset da
sessão no código antes de ser utilizada</li>
    </ul>
  </ul>
  <li>Terão de ser criadas, na pasta <span style="font-weight: bold;">custom</span>, duas
pastas
com os nomes <span style="font-weight: bold;">css</span> e <span style="font-weight: bold;">js</span> que irão conter os
ficheiros CSS
e Javascript necessários (por ex. os ficheiros <span style="font-weight: bold;">.js</span>
das bibliotecas de validação).</li>
  <li>Colocar o seguinte no final do ficheiro <span style="font-weight: bold;">functions.php</span>
do
theme (Ir a: <span style="font-weight: bold;">Appearance</span>-&gt;<span style="font-weight: bold;">Editor</span> e, no lado direito, procurar
por <span style="font-weight: bold;">Theme functions</span> e clicar
neste link):</li>
  <ul>
    <li style="font-family: monospace;">wp_enqueue_style('ag',
get_bloginfo( 'wpurl' ) .
'/custom/css/ag.css',false,'1.1','all');</li>
    <li>Nota: na pasta <span style="font-weight: bold;">css</span>,
tem de ser criado um ficheiro com o nome <span style="font-weight: bold;">ag.css</span>
onde podem ser colocadas as instruções CSS a serem
aplicadas nos
conteúdos HTML dos componentes da AGCT. <span style="text-decoration: underline;">Todos os
estilos CSS utilizados pelos grupos (inclusivé os das
bibliotecas
de validação) têm de ser copiados para dentro deste
ficheiro</span>. </li>
  </ul>
</ul>

<h3>Regras a seguir na programação</h3>

<ul>

  <li style="background-color: yellow;"><span style="font-weight: bold; text-decoration: underline;">Atenção
às maiúsculas e minúsculas</span>!
No Linux os nomes de ficheiros e nomes de tabelas/atributos em SQL
são case-sensitive. <span style="font-weight: bold; text-decoration: underline;">Os nomes dos
ficheiros têm de ter
letras todas minúsculas e os nomes das tabelas/atributos
é também
para ficar tudo em minúsculas</span>.</li>
  <li><span style="background-color: yellow;">Atenção
que nos formulários HTML não devem haver campos com nome
"name" pois irá dar problemas na execução, usar
nomes do género <span style="font-weight: bold;">component_name</span>,
etc.</span><br>
  </li>
  <li>Na especificação dos componentes (apresentada na
secção do enunciado após as dicas) é
indicado, para os formulários a constar
nos mesmos, para cada campo, o seguinte conjunto de items separados por
um traço:</li>
  <ul>
    <li>a negrito - <a style="font-weight: bold;" href="http://www.w3schools.com/html/html_forms.asp">tipo de input</a>
(o nome do respetivo campo deverá ser uma string sempre em
minúsculas e com
underscore em vez dos espaços, devendo tal nome ser
idêntico ou próximo
do nome do respetivo atributo existente na BD, <span style="text-decoration: underline;">caso
apareça um nome entre parêntesis à frente do tipo
de input, é esse o
nome para ser usado como nome do campo e que irá corresponder ao
nome
da chave no array POST/REQUEST</span>)</li>
    <li>a itálico <span style="font-style: italic;">-
descrição do
campo que tem de aparecer no output antes do mesmo</span> <br>
    </li>
    <li>dentro de parêntesis - regras de preenchimento do campo
(que
deverão ser mostradas também no output junto aos
respectivos campo da forma mais
intuitiva, normalmente após os mesmos, à direita ou
abaixo)</li>
    <li>sublinhado - <span style="text-decoration: underline;">dicas/instruções
de apresentação</span></li>
  </ul>
  <li style="background-color: yellow;">Para obtenção dos
resultados de uma query que faça um select, recomenda-se a
utilização da seguinte função (ver exemplo
"procedural style" no site):<a href="http://us1.php.net/manual/en/mysqli-result.fetch-assoc.php">
http://us1.php.net/manual/en/mysqli-result.fetch-assoc.php</a></li>
  <li>Sem ser em formulários, ao longo da
especificação dos
componentes, sempre que aparecer <span style="font-style: italic;">texto
em itálico</span> significa que é texto que deverá
ser apresentado ao
utilizador e <span style="text-decoration: underline;">texto sublinhado</span>
significam instruções a serem seguidas para
apresentação de conteúdos.<br>
  </li>
  <li>Realizar validação <span style="font-weight: bold;">server-side</span>,
dos inputs que necessitarem de validação (campos
obrigatórios, formato
de emails, datas, etc.) no código que processa os campos
submetidos o
qual tem de voltar a
mostrar o formulário submetido (com todos os dados já
inseridos)
indicando o(s) erro(s) se for o caso. <br>
  </li>
  <li>Realizar validação <span style="font-weight: bold;">client-side</span>
em tempo real usando <a href="http://jqueryvalidation.org/">esta
biblioteca</a>
(<span style="background-color: yellow;">nova bibioteca mais poderosa
que deve ser usada</span>) ou outra melhor (informar o docente em caso
de
localização de melhor
alternativa).<span style="text-decoration: line-through;"></span> <span style="background-color: yellow;">NOTA
IMPORTANTE: o uso destas bibliotecas (ou outras com
função idêntica) não
é necessário para obtenção de nota
mínima (embora seja atribuído um certo peso na nota
final), <span style="text-decoration: underline;">logo deixar a
validação client-side para mais tarde em
caso de dificuldades na
instalação/utilização</span>)</span>.</li>
  <li>Ao serem inseridos tuplos em mais que uma tabela, ou seja, ao
haver uma sequência de comandos INSERT que têm todos de ser
executados
ou nenhum, delimitar as instruções INSERT por uma
transacção. <span style="background-color: yellow;">NOTA
IMPORTANTE: (a utilização de transacções </span><span style="background-color: yellow;">não
é necessária para obtenção de nota
mínima (embora seja atribuído um certo peso na nota
final), <span style="text-decoration: underline;">logo deixar para
mais tarde em
caso de dificuldades</span>)</span>.</li>
  <li>Deve ser usada a tecnologia <a href="http://pt.wikipedia.org/wiki/Cascading_Style_Sheets">CSS</a>
para a <span style="text-decoration: underline;">especificação
do formato de
apresentação de todos os conteúdos</span>, o que
permite separar completamente a
lógica de estrutura de
um documento (secções, linhas, campos, etc.) da sua
lógica de
apresentação (tamanhos de letra, cores, alinhamentos,
etc.).
Nomeadamente, para o output de formulários, devem ser usadas as
tags
html
DIV, LABEL, FIELDSET, etc. para a especificação da
estrutura do
formulário, sendo aplicadas as classes CSS adequadas para a
correcta
apresentação dos conteúdos.</li>
  <li style="background-color: yellow;">Não é
necessário realizar conexão à base de dados, pois
o Wordpress já mantém a ligação ao mysql
ativa e é possível executar diretamente o comando
mysql_query ao longo do código especificado.</li>
  <li>Criar um ficheiro chamado <span style="font-weight: bold;">common.php</span>
que terá de ficar na pasta <span style="font-weight: bold;">custom/php</span>.</li>
  <ul>
    <li>Este
ficheiro terá de incluir todas as funções PHP que
são para
ser reutilizadas entre componentes diferentes e/ou chamadas a
bibliotecas Javascript (por exemplo,
funções de validação server-side, chamada
à bibliotecas, etc.). <span style="font-weight: bold; background-color: yellow;">NOTA</span><span style="background-color: yellow;">: Código
a ser reutilizado em apenas um componente tem de ser colocado em
funções definidas no próprio componente</span>. </li>
  </ul>
  <li><span style="text-decoration: underline;">Não podem ser
criadas referências/links a caminhos absolutos e
têm&nbsp;sempre
de ser usados caminhos relativos</span>. Exemplos:</li>
  <ul>
    <li>na especificação de um action de um formulario,
em vez de <span style="font-family: monospace;">http://10.42.43.10/wordpress/gestao-de-componentes"</span>
tem de constar <span style="font-family: monospace;">"gestao-de-componentes"</span></li>
    <li><span style="font-family: monospace;"></span>em
relação ao ficheiro <span style="font-weight: bold;">common.php</span>,
explicado acima, todos os ficheiros php de componentes (como o
gestao-de-componentes.php) terão de ter como primeira
instrução PHP (logo a seguir a <span style="font-weight: bold;">&lt;?php</span>)
a
seguinte (inclusão com caminho relativo de código PHP de
um
ficheiro): <span style="font-family: monospace;">require_once("custom/php/common.php");</span><br>
    </li>
  </ul>
  <li>A chamada às bibliotecas de validação
Javascript deverá ser feita com uma ou mais
funções php (ou com o próprio código
Javascript): (1) ou no
ficheiro common.php, ou (2) no próprio código do
componente, imediatamente antes de serem usadas. Por exemplo, logo no
início do ficheiro common.php (e <span style="text-decoration: underline;">antes</span> de <span style="font-weight: bold;">&lt;?php</span>) pode constar o
código: <span style="font-family: monospace;">&lt;script
type="text/javascript"
src="&lt;?php echo
get_bloginfo('wpurl');?&gt;/custom/js/anytime.js"&gt;&lt;/script&gt;</span>
que invoca uma biblioteca.</li>
  <li>Em vez de se usar os arrays $_POST e $_GET, utilizar o array
$_REQUEST que contém todos os campos passados tanto por GET como
POST</li>
  <li>Na execução dos componentes, os estados de
validação (server-side) devem ter um if que
primeiro faz as validações (só dos campos do tipo
text pois os de tipo select ou checkbox não precisam de
validação pois são valores que foram retirados da
BD)
e só no caso de não haver erros é que são
apresentados os dados inseridos e a opção de confirmar a
inserção. Caso contrário é só
mostrado o(s)
erro(s) e a opção de voltar atrás.</li>
  <li>Em todos os estados em que são mostrados os dados ao
utilizador antes de ele confirmar, não é suposto voltar a
ser apresentado um formulário com os dados, mas texto contendo a
informação introduzida, sendo que é realizado
output do formulário mas com os respectivos campos
hidden e depois o botão de confirmar.</li>
  <li>Quando há erros no código, é só
estar atento a qual a linha do
"eval'd code" que é a prevaricadora. Será essa linha no
código
PHP que estará a provocar o erro.</li>
  <ul>
  </ul>
  <ul>
  </ul>
  <li>Quando tabelas com dados tiverem muitas colunas e o
conteúdo "salte fora" do espaço onde é suposto
estar, deverá de ser usado CSS para que a tabela toda caiba no
respectivo espaço. A tag HTML que inicia a tabela deverá
ser do género: <span style="font-family: monospace;">&lt;table
class="mytable" style="text-align: left; width: 100%;" border="1"
cellpadding="2" cellspacing="2"&gt;</span>, em que <span style="font-family: monospace;">class="mytable"</span> indica o nome
da
classe cujo estilo é para aplicar nesta tabela. Depois,
terá de ser incluído no ficheiro <span style="font-weight: bold;">ag.css</span> código do tipo
(reduzir font-size caso necessário e não remover o
código <span style="font-weight: bold;">!important</span> pois
o estilo deixa de
funcionar.):</li>
  <ul>
    <li><span style="font-family: monospace;">.mytable td, </span><span style="font-family: monospace;">.mytable th</span><span style="font-family: monospace;"> {</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; margin:
0&nbsp; !important;</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; border:
1px solid !important;</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp; padding:
1px !important;</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
font-size: 11px&nbsp; !important;</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">}</span><br>
    </li>
  </ul>
  <li>Todos os estados de todos os componentes que não sejam os
estados iniciais têm sempre de incluir uma ligação <span style="font-weight: bold;">Voltar atrás</span> cujo
código deve ser algo do género (solução
retirada <a href="http://www.wdmac.com/acessibility-the-back-button">aqui</a>,
recomenda-se colocar este código numa função no
ficheiro common.php e chamar essa função sempre que
necessário):</li>
  <ul>
    <li><span style="font-family: monospace;">&lt;?php</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">echo "&lt;script
type='text/javascript'&gt;document.write(\"&lt;a
href='javascript:history.back()' class='backLink' title='Voltar
atr&amp;aacute;s'&gt;Voltar
atr&amp;aacute;s&lt;/a&gt;\");&lt;/script&gt;</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&lt;noscript&gt;</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&lt;a
href='".$_SERVER['HTTP_REFERER']."‘ class='backLink' title='Voltar
atr&amp;aacute;s'&gt;Voltar atr&amp;aacute;s&lt;/a&gt;</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">&lt;/noscript&gt;";</span><br style="font-family: monospace;">
      <span style="font-family: monospace;">?&gt;</span><br>
    </li>
  </ul>
  <li>Para se obter o role de um user basta usar
funções/variáveis do próprio wordpress,
alguns exemplos podem ser encontrados <a href="http://wordpress.org/support/topic/how-to-get-the-current-logged-in-users-role">aqui</a>.<br>
  </li>
  <li>Sempre que são realizadas queries convém invocar a
função mysql_error como é feito nos slides da aula
teórica pois ajuda na descoberta de bugs.</li>
  <li>Cuidado com a replicação de código! É
comum repetir-se o mesmo código SQL, para diferentes casos em
diferentes pesquisas (dependendo de que campos
são seleccionados pelo utilizador). Em vez de
repetição deve haver
reutilização. Nestes casos é só criar uma
variável (string) com a parte inicial da query e ir concatenando
a essa string os
bocados de SQL necessários, de acordo com o que terá sido
especificado pelo utilizador</li>
  <li>Nem sempre está ligação ativa por parte do
wordpress à BD, pelo que, pelo seguro, convém sempre
realizar ligação sempre que necessário, o que
poderá ser feito com código do género
(possível de colocar numa função no ficheiro
common.php:<br>
    <div style="margin-left: 40px;">
    <pre>$link = mysqli_connect(DB_HOST,DB_USER,DB_PASSWORD,DB_NAME);</pre>
    <pre>$result = mysqli_query($link,$query);</pre>
    </div>
em que na 1ª linha estão constantes definidas
automaticamente pelo Wordpress.<br>
  </li>
  <li>Todos os comandos php mysql deverão incluir a letra "i"
(como os acima) pois correspondem à versão mais recente e
a sem o "i" nem sempre funciona como esperado, estando em fase de ser
deprecada.<br>
  </li>
  <li>Quando a query SQL a construir varia consoante várias
condições diferentes (por exemplo, parâmetros
opcionais), a mesma pode ir sendo construída aos poucos com a
operação de concatenação a ser executada ao
longo de cada if, em vez de serem realizados inúmeros ifs e uma
query (praticamente idêntica) para cada if</li>
  <li>Para ser possível a verificação do
funcionamento da validação server side, é
necessário estar desativada a validação client
side, pelo que todos os grupos que implementem validação
clientside devem incluir uma variável no ficheiro common.php
chamada $clientsideval=0; variável esta que deverá ser
testada antes da realização de qualquer output de
código de validação client side (como o atributo
"required"), output o qual só deverá ocorrer se a
variável for true (=1).<br>
  </li>
  <li>Algumas instalações podem ter problemas na
execução dos estados após o inicial quando o
action no formulário é especificado conforme neste
enunciado, sendo que a alternativa será não especificar o
atributo action, o que leva à execução do action
como sendo uma chamada à própria página, o que
funciona na mesma<br>
  </li>
  <li>Para simplificar a inserção de tuplos em que algum
atributo que é foreign key e pode ser nulo e porque pode haver
problemas ao colocar-se o termo "NULL" no código SQL, o mais
simples é colocar na respetiva tabela no phpmyadmin como default
value desse atributo o valor NULL e, ao realizar-se a
inserção para o caso de ser nulo esse atributo,
simplesmente não incluir esse atributo no INSERT.<br>
  </li>
  <li>...<br>
  </li>
  <ul>
    <ul>
    </ul>
  </ul>
</ul><h2>Componentes</h2>

<h3>Gestão de entidades</h3>

Página <span style="font-weight: bold;">gestao-de-entidades</span><br>

<ul>

  <li>Criar no Wordpress (menu Users) uma nova capability chamada <span style="font-weight: bold;">Manage entities</span> e activar esta
capability para o Role <span style="font-weight: bold;">Administrator</span>.</li>
  <li>Este componente, ao ser executado, faz primeiramente um teste se
foi realizado um login no Wordpress e se o utilizador com sessão
iniciada tem (independentemente do seu role) a capability <span style="font-weight: bold;">Manage entities</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></li>
  <li>Caso não tenha, é mostrada uma mensagem a dizer
"Não tem
autorização para aceder a esta página", caso
tenha, é executado o
comportamento a seguir especificado.</li>
  <li>Se não vier nenhum
valor na variável (POST) sobre o estado de
execução, é apresentado:</li>
  <ul>
    
    <li>Se não houverem tuplos na tabela <span style="font-weight: bold;">ent_type</span> apresentar o
texto "<span style="font-style: italic;">Não há entidades"</span>
caso contrário, apresentar uma lista com todos os componentes
com o seguinte formato (ordenada por ordem alfabética):</li>
</ul></ul>
<ul>
  <ul>

    <ul>
      <li>
        <div style="text-align: center;">
        </div>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">
          <tbody>
            <tr>
              
              <td style="vertical-align: top; text-align: center;"><span style="font-weight: bold;">id</span><br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">nome<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><span style="font-weight: bold;">estado</span><br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">ação<br>
              </td>
            </tr>
            <tr>
              
              <td style="vertical-align: top; text-align: center;">1<br>
              </td>
              <td style="vertical-align: top; text-align: center;">entidade a faturar<br>
              </td>
              <td style="vertical-align: top; text-align: center;">ativo<br>
              </td>
              <td style="vertical-align: top; text-align: center;">[editar] [desativar]<br>
              </td>
            </tr>
            <tr>
              <td style="vertical-align: top; text-align: center;">2<br>
              </td>
              <td style="vertical-align: top; text-align: center;">serviços
contratados </td>
              <td style="vertical-align: top; text-align: center;">ativo</td>
              <td style="vertical-align: top; text-align: center;">[editar] [desativar]</td>
            </tr>
            <tr>
              <td style="vertical-align: top; text-align: center;">3<br>
              </td>
              <td style="vertical-align: top; text-align: center;">áreas </td>
              <td style="vertical-align: top; text-align: center;">ativo </td>
              <td style="vertical-align: top; text-align: center;">[editar] [desativar]</td>
            </tr>
            <tr>
              <td style="vertical-align: top; text-align: center;">4<br>
              </td>
              <td style="vertical-align: top; text-align: center;">tv<br>
              </td>
              <td style="vertical-align: top; text-align: center;">ativo</td>
              <td style="vertical-align: top; text-align: center;">[editar] [desativar] </td>
            </tr>
            <tr>
              
              <td style="vertical-align: top; text-align: center;">5<br>
              </td>
              <td style="vertical-align: top; text-align: center;">nome<br>
              </td>
              <td style="vertical-align: top; text-align: center;">ativo</td>
              <td style="vertical-align: top; text-align: center;">[editar] [desativar]</td>
            </tr>
            <tr>
              <td style="vertical-align: top; text-align: center;">6<br>
              </td>
              <td style="vertical-align: top; text-align: center;">custos<br>
              </td>
              <td style="vertical-align: top; text-align: center;">ativo</td>
              <td style="vertical-align: top; text-align: center;">[editar] [desativar]</td>
            </tr>
            <tr>
              <td style="vertical-align: top; text-align: center;">7<br>
              </td>
              <td style="vertical-align: top; text-align: center;">comissão<br>
              </td>
              <td style="vertical-align: top; text-align: center;">ativo</td>
              <td style="vertical-align: top; text-align: center;">[editar] [desativar]</td>
            </tr>
            <tr>
              
              <td style="vertical-align: top; text-align: center;">...<br>
              </td>
              <td style="vertical-align: top; text-align: center;">...<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
            </tr>
          </tbody>
        </table>
(<span style="font-weight: bold;">notas</span>: propriedade aqui
significa um imóvel tipo casa, apartamento, etc.; para
já, apresentar na coluna <span style="font-weight: bold;">ação</span>
apenas o
texto
lá indicado, mais tarde será especificado o que fazer)</li>
      <li>Dicas:</li>
      <ul>
        <li>ao realizar output do &lt;td&gt; do tipo é
necessário indicar valores para os atributos
HTML <span style="font-weight: bold;">colspan</span> <span style="font-weight: bold;">rowspan</span>,
sendo que o primeiro é 1 e o segundo é igual ao
número de componentes existentes desse tipo - no
exemplo acima (ver código-fonte HTML) temos, para os primeiros 2
tipos apresentados, rowspans de 3. Quando acontece este
"span" de X em N colunas, nas X-1 linhas seguintes da tabela
(&lt;tr&gt;) só
é preciso especificar N-1 colunas (por ex., na linha
de altura, só há 4 &lt;td&gt;</li>
        <li>não fazer uma query gigante para toda a tabela,
primeiro
deve fazer-se uma query para obter a lista de tipos e
iniciar um ciclo para, em cada iteração deste ciclo,
realizar-se o output dos componentes de
cada tipo, sendo que será
necessário outra nova query para se obter os componentes deste
tipo</li>
        <ul>
          <li>no 1º td já se deve ter em conta o
aspeto acima referido do rowspan, determinado automaticamente a partir
do número de linhas da query anterior<br>
          </li>
        </ul>
      </ul>
    </ul>
  
  </ul>

</ul>


<ul>

  <ul>
    <ul>
    </ul>
    <li>Apresentar após a tabela acima o Sub-título
(heading 3): <span style="font-style: italic;"><span style="font-weight: bold;">Gestão de entidades</span></span><span style="font-style: italic;"><span style="font-weight: bold;"> -
introdução</span></span> e logo depois um
formulário que possibilita a inserção de um novo
componente:</li>
    <ul>
      <li><span style="font-weight: bold;">text</span> - <span style="font-style: italic;">Nome</span> - (obrigatório)</li><li><span style="font-weight: bold;">radio</span> - <span style="font-style: italic;">Estado</span> -
(obrigatório)</li>
      <ul>
        <li><input checked="checked" name="state" value="active" type="radio">ativo</li>
        <li><input name="state" value="inactive" type="radio">inativo<br>
        </li>
      </ul>
    </ul>
    <ul>
      <ul>
        <li><span style="text-decoration: underline;">em que cada
opção tem como value o respetivo valor do respetivo
atributo state que é do tipo ENUM<br>
          </span></li>
      </ul>
      <li><span style="font-weight: bold;">hidden</span> (estado) -
value: <span style="font-weight: bold;">inserir</span></li>
      <li><span style="font-weight: bold;">submit</span> - <span style="font-style: italic;">Inserir entidade</span><br>
      </li>
    </ul>
    <li>Se o estado de execução é <span style="font-weight: bold;">inserir</span><span style="font-weight: bold;"></span></li>
    <ul>
      <li>Sub-título deste estado (heading 3): <span style="font-style: italic;"><span style="font-weight: bold;">Gestão
de entidades</span></span><span style="font-style: italic;"><span style="font-weight: bold;"> -
inserção</span><br>
        </span></li>
      <li>construir uma string com o comando SQL necessário
para
inserção dos dados na tabela <span style="font-weight: bold;">ent_type</span>
e executá-lo</li>
      <li>Apresentar, em caso de sucesso da
inserção:</li>
      <ul>
        <li><span style="font-style: italic;">Inseriu os dados de uma nova entidade com sucesso.</span></li>
        <li><span style="font-style: italic;">Clique em </span><span style="font-weight: bold; font-style: italic;">Continuar</span><span style="font-style: italic;"> para avançar</span></li>
        <li>em que Continuar é uma ligação para a
página <span style="font-weight: bold;">gestao-de-entidades</span></li><span style="font-weight: bold;"><br>
        </span><span style="font-weight: bold;"></span><br>
        <span style="font-weight: bold;"></span></ul></ul></ul></ul>
<ul>
  <ul>
    <ul>
      <ul>
        <span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span>
      
      </ul>

    
    </ul>

  
  </ul>

</ul>


<h3>Gestão de relações</h3>

Página <span style="font-weight: bold;">gestao-de-relacoes</span><br>
<ul>
<li>Criar no Wordpress (menu Users) uma nova capability chamada <span style="font-weight: bold;">Manage relation</span> e activar esta
capability para o Role <span style="font-weight: bold;">Administrator</span>.</li><li>Este componente, ao ser executado, faz primeiramente um teste se
foi realizado um login no Wordpress e se o utilizador com sessão
iniciada tem (independentemente do seu role) a capability <span style="font-weight: bold;">Manage relation</span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span><span style="font-weight: bold;"></span></li><li>Caso não tenha, é mostrada uma mensagem a dizer
"Não tem
autorização para aceder a esta página", caso
tenha, é executado o
comportamento a seguir especificado.</li>
  <li>Se não vier nenhum
valor na variável (POST) sobre o estado de
execução, é apresentado:</li>
  <ul>
    <li>Se não houverem 2 ou mais tuplos na tabela <span style="font-weight: bold;">ent_type</span> apresentar o
texto "<span style="font-style: italic;">Não existem entidades que se possam relacionar"</span>
caso contrário, <br>
    </li>
  </ul>
<ul><li>Se não houverem tuplos na tabela <span style="font-weight: bold;">rel_type</span> apresentar o
texto "<span style="font-style: italic;">Não há tipos de relação"</span>
car uma lista com todas as relações
com o seguinte formato (ordenada por ordem alfabética):aso contrário, apresent</li></ul>
</ul>
<ul>
  <ul>
    <ul>
      <li>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  
        <table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">
          <tbody>
            <tr>
              <td style="vertical-align: top; text-align: center;"><span style="font-weight: bold;">ID</span><br>
              </td>
              <td style="vertical-align: top; text-align: center;"><span style="font-weight: bold;">Entidade 1</span><br>
              </td>
              <td style="vertical-align: top; text-align: center;"><span style="font-weight: bold;">Entidade 2</span><br>
              </td>
              <td style="vertical-align: top; text-align: center;"><span style="font-weight: bold;">Ação</span><br>
              </td>
            </tr>
            <tr>
              <td style="vertical-align: top; text-align: center;">1<br>
              </td>
              <td style="vertical-align: top; text-align: center;">Casa<br>
              </td>
              <td style="vertical-align: top; text-align: center;">Serviços Contratados<br>
              </td>
              <td style="vertical-align: top; text-align: center;">[editar] [desativar]</td>
            </tr>
            <tr>
              <td style="vertical-align: top; text-align: center;">2<br>
              </td>
              <td style="vertical-align: top; text-align: center;">...<br>
              </td>
              <td style="vertical-align: top; text-align: center;">...<br>
              </td>
              <td style="vertical-align: top; text-align: center;">[editar] [desativar]</td>
            </tr>
            <tr>
              <td style="vertical-align: top; text-align: center;">...<br>
              </td>
              <td style="vertical-align: top; text-align: center;">...<br>
              </td>
              <td style="vertical-align: top; text-align: center;">...<br>
              </td>
              <td style="vertical-align: top; text-align: center;">...<br>
              </td>
            </tr>
          </tbody>
        </table>
        <br>
      </li>
    </ul>
    <li>Apresentar após a tabela acima o Sub-título
(heading 3): <span style="font-style: italic;"><span style="font-weight: bold;">Gestão de relações</span></span><span style="font-style: italic;"><span style="font-weight: bold;"> -
introdução</span></span> e logo depois um
formulário que possibilita a inserção de um novo
tipo de relação:</li>
    <ul>
      <li><span style="font-weight: bold;">selectbox</span> - Entidade 1 - (obrigatório) - <span style="text-decoration: underline;">apresentar uma lista com os nomes
de todas as entidades presentes na tabela <span style="font-weight: bold;">ent_type</span></span></li>
      <li><span style="font-weight: bold;">selectbox</span> - Entidade 2 - (obrigatório)<span style="font-weight: bold;"></span> - <span style="text-decoration: underline;">apresentar uma lista com os nomes
de todas as entidades presentes na tabela <span style="font-weight: bold;">ent_type</span></span></li>
      <li><span style="font-weight: bold;">hidden</span> (estado) -
value: <span style="font-weight: bold;">inserir</span></li>
      <li><span style="font-weight: bold;">submit</span> - <span style="font-style: italic;">Inserir tipo de relação</span></li>
    </ul>
  </ul>
  <li>Se o estado de execução é <span style="font-weight: bold;">inserir</span><span style="font-weight: bold;"></span></li>
  <ul>
<li>Sub-título deste estado (heading 3): <span style="font-style: italic;"><span style="font-weight: bold;">Gestão
de relações</span></span><span style="font-style: italic;"><span style="font-weight: bold;"> -
inserção</span><br>
      </span></li><li>construir uma string com o comando SQL necessário
para
inserção dos dados na tabela <span style="font-weight: bold;">rel_type</span>
e executá-lo</li><li>Apresentar, em caso de sucesso da
inserção:</li><ul><li><span style="font-style: italic;">Inseriu os dados de novo
tipo de relação com sucesso.</span></li><li><span style="font-style: italic;">Clique em </span><span style="font-weight: bold; font-style: italic;">Continuar</span><span style="font-style: italic;"> para avançar</span></li><li>em que Continuar é uma ligação para a
página <span style="font-weight: bold;">gestao-de-relacoes</span></li></ul>
  </ul>
</ul>





<h3>Gestão de unidades<br>
</h3>


Página <span style="font-weight: bold;">gestao-de-unidades</span>
<ul>

  <li>Criar no Wordpress (menu Users) uma nova capability chamada <span style="font-weight: bold;">Manage unit types</span> e activar esta
capability para o Role <span style="font-weight: bold;">Administrator</span>.</li>
  <li>Este componente, ao ser executado, faz primeiramente um teste se
foi realizado um login no Wordpress e se o utilizador com sessão
iniciada tem (independentemente do seu role) a capability <span style="font-weight: bold;">Manage unit types</span><span style="font-weight: bold;"></span></li>
  <li>Caso não tenha, é mostrada uma mensagem a dizer
"Não tem
autorização para aceder a esta página", caso
tenha, é executado o
comportamento a seguir especificado.</li>
  <li>Se não vier nenhum
valor na variável (POST) sobre o estado de
execução é apresentado:</li>
  <ul>
    <li>Se não houverem tuplos na tabela <span style="font-weight: bold;">prop_unit_type</span>, apresentar o
texto "<span style="font-style: italic;">Não há
tipos de unidades</span>",
caso contrário, apresentar uma lista com todos os tipos de
unidades
com o seguinte formato (ordenada por ordem alfabética):</li>
  </ul>
  <ul>
    <ul>
      <li>
        <div style="text-align: center;">
        </div>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">
          <tbody>
            <tr>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">id<br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">unidade<br>
              </td>
            </tr>
            <tr>
              <td style="vertical-align: top; text-align: center;">1<br>
              </td>
              <td style="vertical-align: top; text-align: center;">m2<br>
              </td>
            </tr>
            <tr>
              <td style="vertical-align: top; text-align: center;">2<br>
              </td>
              <td style="vertical-align: top; text-align: center;">cm<br>
              </td>
            </tr>
            <tr>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
            </tr>
          </tbody>
        </table>
      </li>
    </ul>
    <li>Apresentar após a tabela acima o Sub-título
(heading 3): <span style="font-style: italic;"><span style="font-weight: bold;">Gestão de unidades</span></span><span style="font-style: italic;"><span style="font-weight: bold;"> -
introdução</span></span> e logo depois um
formulário que possibilita a inserção de um novo
tipo de unidade:</li>
  </ul>
  <ul>
    <li><span style="font-weight: bold;">text</span> - <span style="font-style: italic;">Nome</span> - (obrigatório)</li>
  </ul>
  <ul>
    <li><span style="font-weight: bold;">hidden</span> (estado) -
value: <span style="font-weight: bold;">inserir</span></li>
    <li><span style="font-weight: bold;">submit</span> - <span style="font-style: italic;">Inserir tipo de unidade</span><br>
    </li>
  </ul>
  <li>Se o estado de execução é <span style="font-weight: bold;">inserir</span><span style="font-weight: bold;"></span></li>
  <ul>
    <li>Sub-título deste estado (heading 3): <span style="font-style: italic;"><span style="font-weight: bold;">Gestão
de unidades</span></span><span style="font-style: italic;"><span style="font-weight: bold;"> -
inserção</span><br>
      </span></li>
    <li>construir uma string com o comando SQL necessário
para
inserção dos dados na tabela <span style="font-weight: bold;">prop_unit_type</span>
e executá-lo</li>
    <li>Apresentar, em caso de sucesso da
inserção:</li>
    <ul>
      <li><span style="font-style: italic;">Inseriu os dados de novo
tipo de unidade com sucesso.</span></li>
      <li><span style="font-style: italic;">Clique em </span><span style="font-weight: bold; font-style: italic;">Continuar</span><span style="font-style: italic;"> para avançar</span></li>
      <li>em que Continuar é uma ligação para a
página <span style="font-weight: bold;">gestao-de-unidades</span></li>
    </ul>
  </ul>
</ul>

<h3>Gestão de propriedades<br>
</h3>

Página <span style="font-weight: bold;">gestao-de-propriedades</span>
<ul>

  <li>Criar no Wordpress (menu Users) uma nova capability chamada <span style="font-weight: bold;">Manage properties</span> e activar esta
capability para o Role <span style="font-weight: bold;">Administrator</span>.</li>
  <li>Este componente, ao ser executado, faz primeiramente um teste se
foi realizado um login no Wordpress e se o utilizador com sessão
iniciada tem (independentemente do seu role) a capability <span style="font-weight: bold;">Manage properties</span><span style="font-weight: bold;"></span></li>
  <li>Caso não tenha, é mostrada uma mensagem a dizer
"Não tem
autorização para aceder a esta página", caso
tenha, é executado o
comportamento a seguir especificado.</li>
  <li>Se não vier nenhum
valor na variável (POST) sobre o estado de
execução é apresentado:</li>
  
  <ul>
    <li>Deverá ser possivel escolher entre&nbsp; entidade ou&nbsp; relação,
sendo que conforme essa seleção o utilizador é encaminhado para a mesma
página mas em que o estado corresponderá respetivamente a <span style="font-weight: bold;">entity</span> ou <span style="font-weight: bold;">relation</span>.<br>
    </li>
  </ul>
<ul></ul>
</ul>
<ul>

  
  <li>Caso o estado de execução seja <span style="font-weight: bold;">entity</span> deverá ser apresentada uma
lista com todas as propriedades que se encontram associadas as entidades</li>
<ul>
    
    
    <li>Se não houverem tuplos na tabela <span style="font-weight: bold;">property</span>, apresentar o
texto "<span style="font-style: italic;">Não há
propiedades especificadas</span>",
caso contrário:</li>
<ul>
      
    </ul>
</ul>
</ul>
<ul>
  <ul>
    <ul>
      <ul>
        <li>
        <div style="text-align: center;">
        </div>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">
          <tbody>
            <tr>
              
              <td style="vertical-align: top;"><span style="font-weight: bold;">Entidade</span><br>
          </td>
<td style="vertical-align: top; font-weight: bold; text-align: center;">id<br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">propriedade<br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">tipo
de valor<br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">nome
do campo<br>
no formulário<br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">tipo
do campo<br>
no formulário</td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">tipo
de unidade<br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">ordem
do campo<br>
no formulário</td>
              <td style="vertical-align: top; text-align: center;"><span style="font-weight: bold;">tamanho do campo no formulário</span><br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">obrigatório<br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">estado<br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">ação<br>
              </td>
            </tr>
            <tr>
              
              <td colspan="1" rowspan="2" style="vertical-align: top; text-align: center;"><br>
propriedade <br>

          </td>
<td style="vertical-align: top; text-align: center;">1<br>
              </td>
              <td style="vertical-align: top; text-align: center;">nome<br>
              </td>
              <td style="vertical-align: top; text-align: center;">text<br>
              </td>
              <td style="vertical-align: top; text-align: center;">pro-1-nome<br>
              </td>
              <td style="vertical-align: top; text-align: center;">text<br>
              </td>
              <td style="vertical-align: top; text-align: center;">-<br>
              </td>
              <td style="vertical-align: top; text-align: center;">1<br>
              </td>
              <td style="vertical-align: top; text-align: center;">128<br>
              </td>
              <td style="vertical-align: top; text-align: center;">sim<br>
              </td>
              <td style="vertical-align: top; text-align: center;">ativo<br>
              </td>
              <td style="vertical-align: top; text-align: center;">[editar]<br>
[desativar]</td>
            </tr>
            <tr>
              
<td style="vertical-align: top; text-align: center;">2<br>
              </td>
              <td style="vertical-align: top; text-align: center;">NIF<br>
              </td>
              <td style="vertical-align: top; text-align: center;">text<br>
              </td>
              <td style="vertical-align: top; text-align: center;">pro-2-nif<br>
              </td>
              <td style="vertical-align: top; text-align: center;">text<br>
              </td>
              <td style="vertical-align: top; text-align: center;">- </td>
              <td style="vertical-align: top; text-align: center;">2<br>
              </td>
              <td style="vertical-align: top; text-align: center;">15<br>
              </td>
              <td style="vertical-align: top; text-align: center;">não<br>
              </td>
              <td style="vertical-align: top; text-align: center;">ativo </td>
              <td style="vertical-align: top; text-align: center;">[editar]<br>
[desativar]</td>
            </tr>
            <tr>
              
              <td colspan="1" rowspan="2" style="vertical-align: top;"><br>
Serviços contratados<br>
</td>
<td style="vertical-align: top; text-align: center;">3<br>
              </td>
              <td style="vertical-align: top; text-align: center;">limpeza<br>
              </td>
              <td style="vertical-align: top; text-align: center;">bool<br>
              </td>
              <td style="vertical-align: top; text-align: center;">ser-3-limpeza<br>
              </td>
              <td style="vertical-align: top; text-align: center;">radio<br>
              </td>
              <td style="vertical-align: top; text-align: center;">- </td>
              <td style="vertical-align: top; text-align: center;">1<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
              <td style="vertical-align: top; text-align: center;">sim<br>
              </td>
              <td style="vertical-align: top; text-align: center;">ativo<br>
              </td>
              <td style="vertical-align: top; text-align: center;">[editar]<br>
[desativar]</td>
            </tr>
            <tr>
              
<td style="vertical-align: top; text-align: center;">4<br>
              </td>
              <td style="vertical-align: top; text-align: center;">comercialização<br>
              </td>
              <td style="vertical-align: top; text-align: center;">enum<br>
              </td>
              <td style="vertical-align: top; text-align: center;">ser-4-comercializao</td>
              <td style="vertical-align: top; text-align: center;">radio<br>
              </td>
              <td style="vertical-align: top; text-align: center;">-<br>
              </td>
              <td style="vertical-align: top; text-align: center;">2<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
              <td style="vertical-align: top; text-align: center;">não<br>
              </td>
              <td style="vertical-align: top; text-align: center;">ativo<br>
              </td>
              <td style="vertical-align: top; text-align: center;">[editar]<br>
[desativar]</td>
            </tr>
            <tr>
              
              <td colspan="1" rowspan="2" style="vertical-align: top;">áreas<br>
                <br>
</td>
<td style="vertical-align: top; text-align: center;">5<br>
              </td>
              <td style="vertical-align: top; text-align: center;">sala<br>
              </td>
              <td style="vertical-align: top; text-align: center;">int<br>
              </td>
              <td style="vertical-align: top; text-align: center;">rea-5-sala<br>
              </td>
              <td style="vertical-align: top; text-align: center;">text<br>
              </td>
              <td style="vertical-align: top; text-align: center;">m2<br>
              </td>
              <td style="vertical-align: top; text-align: center;">1<br>
              </td>
              <td style="vertical-align: top; text-align: center;">4<br>
              </td>
              <td style="vertical-align: top; text-align: center;">não</td>
              <td style="vertical-align: top; text-align: center;">ativo</td>
              <td style="vertical-align: top; text-align: center;">[editar]<br>
[desativar]</td>
            </tr>
            <tr>
              
<td style="vertical-align: top; text-align: center;">6<br>
              </td>
              <td style="vertical-align: top; text-align: center;">suite<br>
              </td>
              <td style="vertical-align: top; text-align: center;">int<br>
              </td>
              <td style="vertical-align: top; text-align: center;">rea-6-suite<br>
              </td>
              <td style="vertical-align: top; text-align: center;">text<br>
              </td>
              <td style="vertical-align: top; text-align: center;">m2<br>
              </td>
              <td style="vertical-align: top; text-align: center;">2<br>
              </td>
              <td style="vertical-align: top; text-align: center;">4<br>
              </td>
              <td style="vertical-align: top; text-align: center;">não</td>
              <td style="vertical-align: top; text-align: center;">inativo</td>
              <td style="vertical-align: top; text-align: center;">[editar]<br>
[ativar]</td>
            </tr>
            <tr>
              
              <td style="vertical-align: top;">tv<br>
          </td>
<td style="vertical-align: top; text-align: center;">7<br>
              </td>
              <td style="vertical-align: top; text-align: center;">diagonal<br>
              </td>
              <td style="vertical-align: top; text-align: center;">int<br>
              </td>
              <td style="vertical-align: top; text-align: center;">tv-7-diagonal<br>
              </td>
              <td style="vertical-align: top; text-align: center;">text<br>
              </td>
              <td style="vertical-align: top; text-align: center;">cm<br>
              </td>
              <td style="vertical-align: top; text-align: center;">1<br>
              </td>
              <td style="vertical-align: top; text-align: center;">4<br>
              </td>
              <td style="vertical-align: top; text-align: center;">não<br>
              </td>
              <td style="vertical-align: top; text-align: center;">ativo</td>
              <td style="vertical-align: top; text-align: center;">[editar]<br>
[ativar]</td>
            </tr>
            <tr>
              
              <td style="vertical-align: top;">...<br>
          </td>
<td style="vertical-align: top; text-align: center;">...<br>
              </td>
              <td style="vertical-align: top; text-align: center;">...<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
              <td style="vertical-align: top;"><br>
              </td>
              <td style="vertical-align: top;"><br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
            </tr>
          </tbody>
        </table>
      </li>
      </ul>
    </ul>
    <ul>
      <br>
</ul></ul></ul>
<ul style="margin-left: 40px;">
  <ul>
    <li>Apresentar após a tabela acima o Sub-título
(heading 3): <span style="font-style: italic;"><span style="font-weight: bold;">Gestão de propriedades</span></span><span style="font-style: italic;"><span style="font-weight: bold;"> -
introdução</span></span> e logo depois um
formulário que possibilita a inserção de uma nova
propriedade:</li>
  </ul>
</ul>
<ul>
  <ul>
    <ul>
      <ul>
        <li><span style="font-weight: bold;">text</span> - <span style="font-style: italic;">Nome da propriedade</span> -
(obrigatório)</li>
        <li><span style="font-weight: bold;">radio</span> - <span style="font-style: italic;">Tipo de valor</span> - (obrigatório)<span style="font-style: italic;"></span>- <span style="text-decoration: underline;">apresentar
uma lista com todos os tipos de valores presentes no atributo
value_type (usar uma função php no ficheiro common.php
para obter diretamente da base de dados os valores de um atributo do
tipo enum como <a href="http://forums.devnetwork.net/viewtopic.php?f=1&amp;t=80136">esta</a>
pois esta função será reutilizada em
situações idênticas) com o seguinte aspeto</span>:<span style="text-decoration: underline;"><br>
      </span></li>
        <ul>
          <li><input checked="checked" name="value_type" value="text" type="radio">text</li>
          <li><input name="value_type" value="int" type="radio">int</li>
          <li>...</li>
        </ul>
      </ul>
    </ul>
    <ul>
      <ul>
        <li><span style="font-weight: bold;">selectbox</span> ( ent_type_id ) - <span style="font-style: italic;">Entidade</span><span style="background-color: yellow;">&nbsp; a que irá pertencer esta
propriedade</span> - (obrigatório) - <span style="text-decoration: underline;">apresentar uma lista com os nomes
de todas as entidades presentes na tabela <span style="font-weight: bold;">entity_type</span></span></li>
        <br>
        <li><span style="font-weight: bold;">radio</span> - <span style="font-style: italic;">Tipo do campo do formulário</span>
- (obrigatório)<span style="font-style: italic;"></span>- <span style="text-decoration: underline;">apresentar
uma lista com todos os tipos de campo de formulário presentes no
atributo form_field_type (usar função recomendada para o
atributo tipo de valor) com o seguinte aspeto</span>:<span style="text-decoration: underline;"><br>
      </span></li>
        <ul>
<li><input checked="checked" name="value_type" value="text" type="radio">text</li><li><input name="value_type" value="int" type="radio">text box<br>
      </li><li>...</li>
        </ul>
        <li><span style="font-weight: bold;">selectbox</span> - <span style="font-style: italic;">Tipo de unidade</span> - (opcional) - <span style="text-decoration: underline;">apresentar uma lista com os nomes
de todos os tipos de unidade presentes na tabela </span><span style="font-weight: bold; text-decoration: underline;">prop_unit_type</span><span style="text-decoration: underline;"> em
que a opção inicial selecionada deverá estar em
branco, o que equivale à inserção de um NULL</span><span style="font-weight: bold; text-decoration: underline;"><br>
      </span></li>
        <li><span style="font-weight: bold;">text</span> - <span style="font-style: italic;">Ordem do campo no formulário</span>
- (obrigatório e um número superior a 0)</li>
        <li><span style="font-weight: bold;">text</span> - <span style="font-style: italic;">Tamanho do campo no formulário</span>
- (obrigatório no caso de o tipo de campo ser <span style="font-style: italic;">text</span> ou <span style="font-style: italic;">text box</span>)</li>
        <li><span style="font-weight: bold;">radio</span> - <span style="font-style: italic;">Obrigatório</span> -
(obrigatório)<span style="font-style: italic;"></span>- <span style="text-decoration: underline;">apresentar
as seguintes duas opções, sendo que na primeira o valor
do campo no formulário na 1ª opção é 1
e na 2ª opção é 0</span>:<span style="text-decoration: underline;"><br>
      </span></li>
        <ul>
<li><input checked="checked" name="value_type" value="text" type="radio">sim</li><li><input name="value_type" value="int" type="radio">não</li>
        </ul>
        <li style="background-color: yellow;"><span style="font-weight: bold;">selectbox</span> - Entidade referenciada
por esta propriedade - (opcional) - <span style="text-decoration: underline;">apresentar uma lista com os nomes
de todas as entidades presentes na tabela <span style="font-weight: bold;">ent_type</span></span><span style="font-weight: bold; text-decoration: underline;"></span></li>
        <li><span style="font-weight: bold;">hidden</span> (estado) -
value: <span style="font-weight: bold;">inserir</span></li>
        <li><span style="font-weight: bold;">submit</span> - <span style="font-style: italic;">Inserir propriedade</span></li>
      </ul>
<br>
      <li>Caso o estado de exeção seja <span style="font-weight: bold;">relation</span></li>
    
    </ul>


  
  
  </ul>

</ul>

<ul>

  <ul>
    <ul>
      
      <ul>
        <li>
        <div style="text-align: center;">
        </div><table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2"><tbody><tr><td style="vertical-align: top;"><span style="font-weight: bold;">Relação</span><br>
                </td>
<td style="vertical-align: top; font-weight: bold; text-align: center;">id<br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">propriedade<br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">tipo
de valor<br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">nome
do campo<br>
no formulário<br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">tipo
do campo<br>
no formulário</td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">tipo
de unidade<br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">ordem
do campo<br>
no formulário</td>
              <td style="vertical-align: top; text-align: center;"><span style="font-weight: bold;">tamanho do campo no formulário</span><br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">obrigatório<br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">estado<br>
              </td>
              <td style="vertical-align: top; font-weight: bold; text-align: center;">ação<br>
              </td>
            </tr>
            <tr>
              
              <td style="vertical-align: top;"><br>
                </td>
<td style="vertical-align: top; text-align: center;">1<br>
              </td>
              <td style="vertical-align: top; text-align: center;">data<br>
</td>
              <td style="vertical-align: top; text-align: center;">text<br>
              </td>
              <td style="vertical-align: top; text-align: center;">dat-1-<br>
</td>
              <td style="vertical-align: top; text-align: center;">text<br>
              </td>
              <td style="vertical-align: top; text-align: center;">-<br>
              </td>
              <td style="vertical-align: top; text-align: center;">1<br>
              </td>
              <td style="vertical-align: top; text-align: center;">128<br>
              </td>
              <td style="vertical-align: top; text-align: center;">sim<br>
              </td>
              <td style="vertical-align: top; text-align: center;">ativo<br>
              </td>
              <td style="vertical-align: top; text-align: center;">[editar]<br>
[desativar]</td>
            </tr>
            <tr>
              <td style="vertical-align: top;"><br>
                </td>
<td style="vertical-align: top; text-align: center;">2<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
</td>
              <td style="vertical-align: top; text-align: center;">text<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
</td>
              <td style="vertical-align: top; text-align: center;">text<br>
              </td>
              <td style="vertical-align: top; text-align: center;">- </td>
              <td style="vertical-align: top; text-align: center;">2<br>
              </td>
              <td style="vertical-align: top; text-align: center;">15<br>
              </td>
              <td style="vertical-align: top; text-align: center;">não<br>
              </td>
              <td style="vertical-align: top; text-align: center;">ativo </td>
              <td style="vertical-align: top; text-align: center;">[editar]<br>
[desativar]</td>
            </tr>
            <tr>
              
              <td style="vertical-align: top;"><br>
                </td>
<td style="vertical-align: top; text-align: center;">3<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
</td>
              <td style="vertical-align: top; text-align: center;">bool<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
</td>
              <td style="vertical-align: top; text-align: center;">radio<br>
              </td>
              <td style="vertical-align: top; text-align: center;">- </td>
              <td style="vertical-align: top; text-align: center;">1<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
              <td style="vertical-align: top; text-align: center;">sim<br>
              </td>
              <td style="vertical-align: top; text-align: center;">ativo<br>
              </td>
              <td style="vertical-align: top; text-align: center;">[editar]<br>
[desativar]</td>
            </tr>
            <tr>
              <td style="vertical-align: top;"><br>
                </td>
<td style="vertical-align: top; text-align: center;">4<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
</td>
              <td style="vertical-align: top; text-align: center;">enum<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
</td>
              <td style="vertical-align: top; text-align: center;">radio<br>
              </td>
              <td style="vertical-align: top; text-align: center;">-<br>
              </td>
              <td style="vertical-align: top; text-align: center;">2<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
              <td style="vertical-align: top; text-align: center;">não<br>
              </td>
              <td style="vertical-align: top; text-align: center;">ativo<br>
              </td>
              <td style="vertical-align: top; text-align: center;">[editar]<br>
[desativar]</td>
            </tr>
            <tr>
              
              <td style="vertical-align: top;"><br>
                </td>
<td style="vertical-align: top; text-align: center;">5<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
</td>
              <td style="vertical-align: top; text-align: center;">int<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
</td>
              <td style="vertical-align: top; text-align: center;">text<br>
              </td>
              <td style="vertical-align: top; text-align: center;">m2<br>
              </td>
              <td style="vertical-align: top; text-align: center;">1<br>
              </td>
              <td style="vertical-align: top; text-align: center;">4<br>
              </td>
              <td style="vertical-align: top; text-align: center;">não</td>
              <td style="vertical-align: top; text-align: center;">ativo</td>
              <td style="vertical-align: top; text-align: center;">[editar]<br>
[desativar]</td>
            </tr>
            <tr>
              <td style="vertical-align: top;"><br>
                </td>
<td style="vertical-align: top; text-align: center;">6<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
</td>
              <td style="vertical-align: top; text-align: center;">int<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
</td>
              <td style="vertical-align: top; text-align: center;">text<br>
              </td>
              <td style="vertical-align: top; text-align: center;">m2<br>
              </td>
              <td style="vertical-align: top; text-align: center;">2<br>
              </td>
              <td style="vertical-align: top; text-align: center;">4<br>
              </td>
              <td style="vertical-align: top; text-align: center;">não</td>
              <td style="vertical-align: top; text-align: center;">inativo</td>
              <td style="vertical-align: top; text-align: center;">[editar]<br>
[ativar]</td>
            </tr>
            <tr>
              
              <td style="vertical-align: top;"><br>
                </td>
<td style="vertical-align: top; text-align: center;">7<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
</td>
              <td style="vertical-align: top; text-align: center;">int<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
</td>
              <td style="vertical-align: top; text-align: center;">text<br>
              </td>
              <td style="vertical-align: top; text-align: center;">cm<br>
              </td>
              <td style="vertical-align: top; text-align: center;">1<br>
              </td>
              <td style="vertical-align: top; text-align: center;">4<br>
              </td>
              <td style="vertical-align: top; text-align: center;">não<br>
              </td>
              <td style="vertical-align: top; text-align: center;">ativo</td>
              <td style="vertical-align: top; text-align: center;">[editar]<br>
[ativar]</td>
            </tr>
            <tr>
              
              <td style="vertical-align: top;"><br>
                </td>
<td style="vertical-align: top; text-align: center;">...<br>
              </td>
              <td style="vertical-align: top; text-align: center;">...<br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
              <td style="vertical-align: top;"><br>
              </td>
              <td style="vertical-align: top;"><br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
              <td style="vertical-align: top; text-align: center;"><br>
              </td>
            </tr>
          </tbody>
        </table>
      </li>
      </ul>

    </ul>
    <br>

    
    <ul>
      <li>Apresentar após a tabela acima o Sub-título
(heading 3): <span style="font-style: italic;"><span style="font-weight: bold;">Gestão de propriedades</span></span><span style="font-style: italic;"><span style="font-weight: bold;"> -
introdução</span></span> e logo depois um
formulário que possibilita a inserção de uma nova
propriedade:</li>
      <ul>


    <li><span style="font-weight: bold;">text</span> - <span style="font-style: italic;">Nome da propriedade</span> -
(obrigatório)</li>
    <li><span style="font-weight: bold;">radio</span> - <span style="font-style: italic;">Tipo de valor</span> - (obrigatório)<span style="font-style: italic;"></span>- <span style="text-decoration: underline;">apresentar
uma lista com todos os tipos de valores presentes no atributo
value_type (usar uma função php no ficheiro common.php
para obter diretamente da base de dados os valores de um atributo do
tipo enum como <a href="http://forums.devnetwork.net/viewtopic.php?f=1&amp;t=80136">esta</a>
pois esta função será reutilizada em
situações idênticas) com o seguinte aspeto</span>:<span style="text-decoration: underline;"><br>
      </span></li>
    <ul>
      <li><input checked="checked" name="value_type" value="text" type="radio">text</li>
      <li><input name="value_type" value="int" type="radio">int</li>
      <li>...</li></ul>
      </ul>
      <ul>
        <li><span style="font-weight: bold;">selectbox</span> ( rel_type_id ) - <span style="font-style: italic;">Relação</span><span style="background-color: yellow;">&nbsp; a que irá pertencer esta
propriedade</span> - (obrigatório) - <span style="text-decoration: underline;">apresentar uma lista com os nomes
de todas as relações presentes na tabela <span style="font-weight: bold;">rel_type</span></span></li>
      </ul>
    </ul>
</ul></ul>
<ul>
  <ul>
    <ul>
      <ul>
      </ul>
      <ul>

    <ul>

    
    </ul>

    
    
    
    <li><span style="font-weight: bold;">radio</span> - <span style="font-style: italic;">Tipo do campo do formulário</span>
- (obrigatório)<span style="font-style: italic;"></span>- <span style="text-decoration: underline;">apresentar
uma lista com todos os tipos de campo de formulário presentes no
atributo form_field_type (usar função recomendada para o
atributo tipo de valor) com o seguinte aspeto</span>:<span style="text-decoration: underline;"><br>
      </span></li>


    <ul>
      <li><input checked="checked" name="value_type" value="text" type="radio">text</li>
      <li><input name="value_type" value="int" type="radio">text box<br>
      </li>
      <li>...</li>
    </ul>
    <li><span style="font-weight: bold;">selectbox</span> - <span style="font-style: italic;">Tipo de unidade</span> - (opcional) - <span style="text-decoration: underline;">apresentar uma lista com os nomes
de todos os tipos de unidade presentes na tabela </span><span style="font-weight: bold; text-decoration: underline;">prop_unit_type</span><span style="text-decoration: underline;"> em
que a opção inicial selecionada deverá estar em
branco, o que equivale à inserção de um NULL</span><span style="font-weight: bold; text-decoration: underline;"><br>
      </span></li>
    <li><span style="font-weight: bold;">text</span> - <span style="font-style: italic;">Ordem do campo no formulário</span>
- (obrigatório e um número superior a 0)</li>
    <li><span style="font-weight: bold;">text</span> - <span style="font-style: italic;">Tamanho do campo no formulário</span>
- (obrigatório no caso de o tipo de campo ser <span style="font-style: italic;">text</span> ou <span style="font-style: italic;">text box</span>)</li>
    <li><span style="font-weight: bold;">radio</span> - <span style="font-style: italic;">Obrigatório</span> -
(obrigatório)<span style="font-style: italic;"></span>- <span style="text-decoration: underline;">apresentar
as seguintes duas opções, sendo que na primeira o valor
do campo no formulário na 1ª opção é 1
e na 2ª opção é 0</span>:<span style="text-decoration: underline;"><br>
      </span></li>
    <ul>
      <li><input checked="checked" name="value_type" value="text" type="radio">sim</li>
      <li><input name="value_type" value="int" type="radio">não</li></ul>
      </ul>
      <ul>
        <li><span style="font-weight: bold;">hidden</span> (estado) -
value: <span style="font-weight: bold;">inserir</span></li>
        <li><span style="font-weight: bold;">submit</span> - <span style="font-style: italic;">Inserir propriedade</span></li>
      </ul>
    </ul>

  
  </ul>

  
  
</ul>
<ul>
<li>Se o estado de execução é <span style="font-weight: bold;">inserir</span></li>
  <ul>
    <li>Verificar se (caso inserido) o valor dos campos <span style="font-style: italic;">Ordem do campo no formulário</span>
e <span style="font-style: italic;">Tamanho do campo no
formulário </span>são
um número e também, se não for, apresentar
mensagem indicando esse erro e mostrando ligação para se
voltar atrás. Apresentar erro também caso tenha sido
escolhido o tipo de campo text ou text box e não tenha sido
indicado valor para o tamanho do campo. No caso do tipo de campo ser
text box, o tamanho do campo tem de ser uma string do género
aaxbb em que aa é o número de colunas e bb o
número de linhas da caixa de texto, devendo haver
validação para se garantir que a string está neste
formato.<br>
    </li>
    <li>Sub-título deste estado (heading 3): <span style="font-style: italic;"><span style="font-weight: bold;">Gestão
de propriedades</span></span><span style="font-style: italic;"><span style="font-weight: bold;"> -
inserção</span></span></li>
    <li>Construir uma string com o comando SQL necessário
para
inserção dos dados na tabela <span style="font-weight: bold;">property</span>
e executá-lo</li>
    <ul>
      <li>Se vier um valor na varíavel POST['rel_type_id']:</li>
      <ul>
<li>o valor para o atributo form_field_name é determinado
neste estado e será uma string
resultante da concatenação dos primeiros
caracteres da entidade a que esta propriedade vai pertencer, seguido
de um traço, seguido do id da propriedade, seguido de outro
traço e seguido do nome da propriedade especificado no respetivo
campo pelo utilizador, sendo que este nome deverá ser
transformado numa cadeia de caracteres só com catacteres
puramente ascii (usando-se por exemplo este código: <span style="font-family: monospace;">$string = preg_replace('/[^a-z0-9_
]/i', '', $string);</span>)
e sendo os espaços substituídos pelo caracter underscore.
A tabela de exemplo de lista de propriedades acima apresenta o
resultado final esperado deste requisito.</li><ul><li><span style="font-weight: bold;">Nota:</span> como
só se pode saber o id da propriedade depois de inseri-la, a
solução mais segura e simples será fazer primeiro
um insert com uma string idêntica à especificada mas sem o
id e, logo de seguida ,
realizar um update já com a string contendo o id, depois de se
obter o id usando-se a função <a href="http://www.php.net/manual/en/mysqli.insert-id.php" data-mce-href="http://www.php.net/manual/en/mysqli.insert-id.php">mysqli_insert_id</a>
(e não a antiga mysql_insert_id que em breve será
obsoleta).</li></ul>
      </ul>
    </ul>
  </ul>
</ul>
<ul>
  <ul>
    <ul>
      <li>Caso contrário isto é se POST['ent_type_id']:<span style="font-weight: bold;"></span></li>
    </ul>
  </ul>
</ul>
<ul>
<ul>
    <ul>
      <ul>
        <li><span style="background-color: yellow;">o valor para o
atributo comp_fk_id
é o id do eventual componente selecionado na segunda select box
e significa que num dado componente (por exemplo tv) esta propriedade
é uma "chave estrangeira" para outro componente. Clarificando,
para por exemplo uma casa/propriedade, instâncias do componente
tv terão um value para esta propriedade do tipo "fk" que
será igual ao id do comp_inst de uma casa particular.</span></li>
      </ul>
    </ul>

    <ul>
      
      
      <ul>
        <li>o valor para o atributo form_field_name é determinado
neste estado e será uma string
resultante da concatenação dos primeiros
caracteres da entidade a que esta propriedade vai pertencer, seguido
de um traço, seguido do id da propriedade, seguido de outro
traço e seguido do nome da propriedade especificado no respetivo
campo pelo utilizador, sendo que este nome deverá ser
transformado numa cadeia de caracteres só com catacteres
puramente ascii (usando-se por exemplo este código: <span style="font-family: monospace;">$string = preg_replace('/[^a-z0-9_
]/i', '', $string);</span>)
e sendo os espaços substituídos pelo caracter underscore.
A tabela de exemplo de lista de propriedades acima apresenta o
resultado final esperado deste requisito.</li>
        <ul>

        <li><span style="font-weight: bold;">Nota:</span> como
só se pode saber o id da propriedade depois de inseri-la, a
solução mais segura e simples será fazer primeiro
um insert com uma string idêntica à especificada mas sem o
id e, logo de seguida ,
realizar um update já com a string contendo o id, depois de se
obter o id usando-se a função <a href="http://www.php.net/manual/en/mysqli.insert-id.php" data-mce-href="http://www.php.net/manual/en/mysqli.insert-id.php">mysqli_insert_id</a>
(e não a antiga mysql_insert_id que em breve será
obsoleta).</li><br>
        </ul>
      </ul>
</ul>
    <li>o valor para o atributo <span style="font-weight: bold;">state</span>
será: "active"</li>

    <li>Apresentar, em caso de sucesso da
inserção:</li>
    <ul>
      <li><span style="font-style: italic;">Inseriu os dados de novo
tipo de propriedade com sucesso.</span></li>
      <li><span style="font-style: italic;">Clique em </span><span style="font-weight: bold; font-style: italic;">Continuar</span><span style="font-style: italic;"> para avançar</span></li>
      <li>em que Continuar é uma ligação para a
página <span style="font-weight: bold;">gestao-de-propriedades</span><span style="font-weight: bold;"></span></li>
    </ul>
  </ul>
</ul>



<h3>Gestão de valores permitidos<br>
</h3>

Página <span style="font-weight: bold;">gestao-de-valores-permitidos</span>
<ul>

  <li>Criar no Wordpress (menu Users) uma nova capability chamada <span style="font-weight: bold;">Manage allowed values</span> e activar esta
capability para o Role <span style="font-weight: bold;">Administrator</span>.</li>
  <li>Este componente, ao ser executado, faz primeiramente um teste se
foi realizado um login no Wordpress e se o utilizador com sessão
iniciada tem (independentemente do seu role) a capability <span style="font-weight: bold;">Manage </span><span style="font-weight: bold;">allowed values</span><span style="font-weight: bold;"></span></li>
  <li>Caso não tenha, é mostrada uma mensagem a dizer
"Não tem
autorização para aceder a esta página", caso
tenha, é executado o
comportamento a seguir especificado.</li>
  <li>Se não vier nenhum
valor na variável (REQUEST) sobre o estado de
execução é apresentado:</li>
  <ul>
    <li>Deverá ser possivel escolher entre entidade ou&nbsp; relação,
de modo a que se possam visualizar todos os valores&nbsp; que pertencem
as propriedades enum da entidades ou relações ,sendo que conforme essa seleção o utilizador é encaminhado para a mesma
página, no entanto o estado corresponderá respetivamente a  <span style="font-weight: bold;">entity</span> ou <span style="font-weight: bold;">relation</span>.</li>
  </ul>
  <li>Caso o estado de execução seja <span style="font-weight: bold;">entity</span> ou <span style="font-weight: bold;">relation:</span></li>
  <ul>
    <li><span style="font-weight: bold;"><span style="text-decoration: underline;">NOTA</span>:
Conforme o estado de excução, as páginas terão um comportamento
semelhante, sendo que estas deverão ser adaptadas respetivamente, caso
estejamos a tratar de entidades ou relações.<br>
      </span></li>
  </ul>

  <ul>
    
    <ul>
      <li>Se não houverem propriedades especificadas (com tipo de
valor enum), apresentar o texto: "<span style="font-style: italic;">Não
há propriedades especificadas cujo tipo de valor seja enum.
Especificar primeiro nova(s) propriedade(s) e depois voltar a esta
opção</span>.".
Caso contrário, apresentar uma lista com todos os valores
permitidos
com o seguinte formato e só para as propriedades cujo tipo de
valor seja enum (ordenada por ordem alfabética), sendo que se
para uma certa propriedade não houverem tuplos na tabela <span style="font-weight: bold;">prop_allowed_value</span>, deve ser
apresentado o
texto "<span style="font-style: italic;">Não há valores
permitidos definidos</span>" na respetiva linha da tabela:</li>
    </ul>

    <li>
      <table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td style="vertical-align: top; font-weight: bold;">entidade<br>
            </td>
            <td style="vertical-align: top;"><span style="font-weight: bold;">id</span><br>
            </td>
            <td style="vertical-align: top; font-weight: bold;">propriedade<br>
            </td>
            <td style="vertical-align: top;"><span style="font-weight: bold;">id</span><br>
            </td>
            <td style="vertical-align: top; font-weight: bold;">valores permitidos<br>
            </td>
            <td style="vertical-align: top;"><span style="font-weight: bold;">estado</span><br>
            </td>
            <td style="vertical-align: top;"><span style="font-weight: bold;">ação</span><br>
            </td>
          </tr>
          <tr>
            <td colspan="1" rowspan="3" style="vertical-align: top;">serviços
contratados<br>
            <br>
            </td>
            <td colspan="1" rowspan="3" style="vertical-align: top;">1<br>
            </td>
            <td colspan="1" rowspan="3" style="vertical-align: top;">[comercialização]<br>
            </td>
            <td style="vertical-align: top;">1<br>
            </td>
            <td style="vertical-align: top;">parcial<br>
            </td>
            <td style="vertical-align: top;">ativo<br>
            </td>
            <td style="vertical-align: top;">[editar]<br>
[desativar]</td>
          </tr>
          <tr>
            <td style="vertical-align: top;">2<br>
            </td>
            <td style="vertical-align: top;">total<br>
            </td>
            <td style="vertical-align: top;">ativo</td>
            <td style="vertical-align: top;">[editar]<br>
[desativar]</td>
          </tr>
          <tr>
            <td style="vertical-align: top;">3<br>
            </td>
            <td style="vertical-align: top;">conjunta<br>
            </td>
            <td style="vertical-align: top;">ativo</td>
            <td style="vertical-align: top;">[editar]<br>
[desativar]</td>
          </tr>
          <tr>
            <td colspan="1" rowspan="6" style="vertical-align: top;">tv<br>
            </td>
            <td colspan="1" rowspan="3" style="vertical-align: top;">3<br>
            </td>
            <td colspan="1" rowspan="3" style="vertical-align: top;">[tecnologia
3D]<br>
            </td>
            <td style="vertical-align: top;">4<br>
            </td>
            <td style="vertical-align: top;">ativa<br>
            </td>
            <td style="vertical-align: top;">ativo<br>
            </td>
            <td style="vertical-align: top;">[editar]<br>
[desativar]</td>
          </tr>
          <tr>
            <td style="vertical-align: top;">5<br>
            </td>
            <td style="vertical-align: top;">passiva<br>
            </td>
            <td style="vertical-align: top;">ativo</td>
            <td style="vertical-align: top;">[editar]<br>
[desativar]</td>
          </tr>
          <tr>
            <td style="vertical-align: top;">6<br>
            </td>
            <td style="vertical-align: top;">grave<br>
            </td>
            <td style="vertical-align: top;">ativo</td>
            <td style="vertical-align: top;">[editar]<br>
[desativar]</td>
          </tr>
          <tr>
            <td colspan="1" rowspan="3" style="vertical-align: top;">4<br>
            </td>
            <td colspan="1" rowspan="3" style="vertical-align: top;">[resolução]<br>
            </td>
            <td style="vertical-align: top;">7<br>
            </td>
            <td style="vertical-align: top;">Half HD<br>
            </td>
            <td style="vertical-align: top;">ativo<br>
            </td>
            <td style="vertical-align: top;">[editar]<br>
[desativar]</td>
          </tr>
          <tr>
            <td style="vertical-align: top;">8<br>
            </td>
            <td style="vertical-align: top;">Full HD<br>
            </td>
            <td style="vertical-align: top;">ativo</td>
            <td style="vertical-align: top;">[editar]<br>
[desativar]</td>
          </tr>
          <tr>
            <td style="vertical-align: top;">9<br>
            </td>
            <td style="vertical-align: top;">Ultra HD </td>
            <td style="vertical-align: top;">ativo</td>
            <td style="vertical-align: top;">[editar]<br>
[desativar]</td>
          </tr>
          <tr>
            <td style="vertical-align: top;">...<br>
            </td>
            <td style="vertical-align: top;">...<br>
            </td>
            <td style="vertical-align: top;">...<br>
            </td>
            <td style="vertical-align: top;">...<br>
            </td>
            <td style="vertical-align: top;">...<br>
            </td>
            <td style="vertical-align: top;">...</td>
            <td style="vertical-align: top;">...</td>
          </tr>
        </tbody>
      </table>
    </li>
  </ul>
</ul>

<ul>

  <ul>
    <li>o texto de cada propriedade corresponde a uma
ligação para o seguinte endereço: "<span style="font-weight: bold;">gestao-de-valores-permitidos?estado=introducao&amp;propriedade=x</span>"
onde <span style="font-weight: bold;">x</span> é o id da
respetiva propriedade nessa linha<br>
    </li>
  </ul>
  <li>Se o estado de execução é <span style="font-weight: bold;">introducao</span></li>
  <ul>
    <li>Guardar numa variável de sessão chamada
property_id o valor que vem no vector REQUEST associado à
variável propriedade</li>
    <li>Apresentar o Sub-título
(heading 3): <span style="font-style: italic;"><span style="font-weight: bold;">Gestão de valores permitidos</span></span><span style="font-style: italic;"><span style="font-weight: bold;"> -
introdução</span></span> e logo depois um
formulário que possibilita a inserção de um novo
valor permitido:</li>
  </ul>
  <ul>
    <li><span style="font-weight: bold;">text</span> - Valor -
(obrigatório)</li>
  </ul>
  <ul>
    <li><span style="font-weight: bold;">hidden</span> (estado) -
value: <span style="font-weight: bold;">inserir</span></li>
    <li><span style="font-weight: bold;">submit</span> - <span style="font-style: italic;">Inserir valor permitido</span><br>
    </li>
  </ul>
  <li>Se o estado de execução é <span style="font-weight: bold;">inserir</span><span style="font-weight: bold;"></span></li>
  <ul>
    <li>Sub-título deste estado (heading 3): <span style="font-style: italic;"><span style="font-weight: bold;">Gestão
de valores permitidos</span></span><span style="font-style: italic;"><span style="font-weight: bold;"> -
inserção</span><br>
      </span></li>
    <li>construir uma string com o comando SQL necessário
para
inserção dos dados na tabela <span style="font-weight: bold;">prop_allowed_value</span>
e executá-lo</li>
    <ul>
      <li>o
valor para o atributo property_id será igual ao que está
na variável de sessão com o mesmo nome e o valor do
atributo state será "active"<br>
      </li>
    </ul>
    <li>Apresentar, em caso de sucesso da
inserção:</li>
    <ul>
      <li><span style="font-style: italic;">Inseriu os dados de novo
valor permitido com sucesso.</span></li>
      <li><span style="font-style: italic;">Clique em </span><span style="font-weight: bold; font-style: italic;">Continuar</span><span style="font-style: italic;"> para avançar</span></li>
      <li>em que Continuar é uma ligação para a
página <span style="font-weight: bold;">gestao-de-valores-permitidos</span></li>
    </ul>
  </ul>
</ul>

<h3>Gestão de formulários customizados<br>
</h3>

Página gestao-de-formularios<br>

<ul>

  <li>Criar no Wordpress (menu Users) uma nova capability chamada <span style="font-weight: bold;">Manage custom forms</span> e activar esta
capability para o Role <span style="font-weight: bold;">Administrator</span>.</li>
  <li>Este componente, ao ser executado, faz primeiramente um teste se
foi realizado um login no Wordpress e se o utilizador com sessão
iniciada tem (independentemente do seu role) a capability <span style="font-weight: bold;">Manage custom forms</span><span style="font-weight: bold;"></span></li>
  <li>Caso não tenha, é mostrada uma mensagem a dizer
"Não tem
autorização para aceder a esta página", caso
tenha, é executado o
comportamento a seguir especificado.</li>
  <li>Se não vier nenhum
valor na variável (REQUEST) sobre o estado de
execução:</li>
  <ul>
    <li>Apresentar o Sub-título
(heading 3): <span style="font-weight: bold;">Gestão de
formulários customizados</span>
e apresentar uma tabela listando os formulários customizados
existentes, idêntica à tabela do componente gestão
de unidades, mas sendo que em vez do nome de unidade, aparece o
nome dado ao formulário customizado. Este nome do form deve ser
clicável, sendo o link disponível, um link para este
próprio componente, mas em que é passado pelo
método GET as variáveis <span style="font-weight: bold;">estado</span>
com o valor <span style="font-style: italic;">editar_form</span> e <span style="font-weight: bold;">id</span> com o id do respetivo
formulário customizado.<br>
    </li>
  </ul>
  <ul>
    <li>Depois apresentar um formulário que permita a
criação de um novo formulário customizado. Neste
formulário, colocar o campo estado hidden com o valor inserir e
apresentar um campo do tipo text onde é para ser indicado o nome
do formulário.</li>
    <li>Depois
deste text input apresentar duas tabelas&nbsp;
idênticas à do componente gestão de propriedades (onde cada tabela
apresenta respetivamente as propriedades dos entidades e as
propriedades das relações ),
mas que em vez da coluna ação, contém uma coluna
chamada <span style="font-weight: bold;">escolher</span>, contendo uma
checkbox que permite escolher essa propriedade para vir a fazer parte
do formulário customizado. Adicionalmente, à direita
desta coluna deve haver outra com o nome <span style="font-weight: bold;">ordem</span> onde é possível
indicar a ordem na qual é suposto aparecer este campo no form
customizado.</li>
    <li>Terminar o formulário com um botão submit
seguindo as mesmas diretrizes que para os outros componentes</li>
  </ul>
  <li>Se
o valor do estado é inserir, inserir nas tabelas custom_form e
custom_form_has_property os respetivos valores de acordo com o que foi
preenchido/escolhido no formulário do ponto anterior.</li>
  <li>Se
o valor do estado é editar, apresentar um
formulário idêntico ao do estado de inserir, mas
apresentando já pré-preenchido o nome do
formulário customizado (que poderá ser atualizado) e
pré-seleccionadas as propriedades pertencentes a este form,
sendo possível selecionar novas ou "des-selecionar" uma
propriedade para deixar de fazer parte deste custom form. O estado
seguinte deverá ser atualizar_form_custom.</li>
  <li>Se
o valor do estado é atualizar_form_custom, realizar os
necessários updates (e/ou deletes) nas respetivas tabelas.<br>
  </li>
</ul>

<h3>Inserção de valores<br>
</h3>

Página <span style="font-weight: bold;">insercao-de-valores</span><br>

<ul>

  <li>Criar no Wordpress (menu Users) uma nova capability chamada <span style="font-weight: bold;">Insert values</span> e activar esta
capability para o Role <span style="font-weight: bold;">Administrator</span>.</li>
  <li>Este componente, ao ser executado, faz primeiramente um teste se
foi realizado um login no Wordpress e se o utilizador com sessão
iniciada tem (independentemente do seu role) a capability <span style="font-weight: bold;">Insert values</span><span style="font-weight: bold;"></span></li>
  <li>Caso não tenha, é mostrada uma mensagem a dizer
"Não tem
autorização para aceder a esta página", caso
tenha, é executado o
comportamento a seguir especificado.</li>
  <li>Se não vier nenhum
valor na variável (REQUEST) sobre o estado de
execução, apresentar o Sub-título
(heading 3): <span style="font-style: italic;"><span style="font-weight: bold;">Inserção de valores</span></span><span style="font-style: italic;"><span style="font-weight: bold;"> -
escolher entidade/formulário customizado</span></span></li>
  <ul>
  </ul>
  <ul>
    <li>Apresentar uma lista dos tipos de entidades
existentes na BD, seguindo-se o seguinte formato:</li>
    <li>Entidade:</li>
    <ul>
      <li>[casa]</li>
      <li>[serviços contratados]</li>
      <li>[tv]</li>
      <li>[quarto]</li>
      <li>[suite]<br>
      </li>
    </ul>

    </ul><ul><li>Formulários customizados</li>
    <ul>
      <li>[Form 1]</li>
      <li>[Form 2]</li>
      <li>...<br>
      </li>
    </ul>
  </ul>
  <ul style="text-decoration: underline;">
    <li>Nota: as listas são construídas dinamicamente
graças às queries necessárias à BD, que
vão buscar os nomes na tabela <span style="font-weight: bold;">ent_type</span>&nbsp; - que aparecem listados entre parêntesis retos, e em que cada
item é uma ligação para o seguinte
endereço: "<span style="font-weight: bold;">insercao-de-valores</span><span style="font-weight: bold;">?estado=introducao&amp;ent=e</span>" onde <span style="font-weight: bold;">e</span> é o id da respetiva entidade nessa
entrada ou "<span style="font-weight: bold;">insercao-de-valores</span><span style="font-weight: bold;">?estado=introducao&amp;form=f</span>" onde <span style="font-weight: bold;">f</span> é o id <span style="font-weight: bold;"></span>do respetivo form customizado </li>
  </ul>
  <li>Se o estado de execução é <span style="font-weight: bold;">introducao</span></li>
  <ul style="text-decoration: underline;">
    <li><span style="font-weight: bold;">Nota:
escrever código
para implementar um comportamento semelhante ao especificado abaixo
para este estado e também para os estados validar e inserir, mas
para o caso de ser escolhido um form customizado, devendo os nomes dos
estados/variáveis ser idênticos mas com "form" em vez de
"ent"<br>
      </span></li>
  </ul>
  <ul>
    <li>Guardar numa variável de sessão chamada <span style="font-weight: bold;">ent_id </span>o valor que vem no vector
REQUEST associado à variável <span style="font-weight: bold;">ent</span></li>
    <li>Guardar numa variável de sessão chamada <span style="font-weight: bold;">ent_name</span> o nome do entidade
associada ao id da linha anterior (necessário pequena query
à BD para buscar este nome)</li><li>Apresentar o Sub-título
(heading 3): <span style="font-style: italic;"><span style="font-weight: bold;">Inserção de valores</span></span><span style="font-style: italic;"><span style="font-weight: bold;"></span></span><span style="font-style: italic;"><span style="font-weight: bold;"> - xxx</span></span>
      <span style="text-decoration: underline;">(onde </span><span style="font-weight: bold; text-decoration: underline;">xxx</span><span style="text-decoration: underline;"> é o valor na
variável de sessão <span style="font-weight: bold;">ent</span></span><span style="font-weight: bold; text-decoration: underline;">_name</span><span style="text-decoration: underline;">)</span></li>
    <li>Apresentar um formulário construído dinamicamente
a partir da informação que consta na BD, nomeadamente:</li>
    <ul>
      <li>o nome do formulário é uma string do
género <span style="font-weight: bold;">ent_x</span>
em que x é o id da entidade.<br>
</li>
      <li>o action do formulário tem o seguite formato <span style="font-weight: bold;">insercao-de-valores</span><span style="font-weight: bold;">?estado=validar&amp;ent=e</span>" onde <span style="font-weight: bold;">e</span> é o id da entidade<br>
</li>
      <li>é feita uma query à BD que obtém todas
as propriedades e relações associadas a entidade selecionada que estejam com o
estado active e, para cada uma, é apresentado o respetivo campo
com a configuração especificada na própria
propriedade. Dicas:</li>
      <ul>
        <li>usar um switch para, conforme o tipo de valor executar o
código apropriado, nomeadamente:</li>
        <ul>
          <li>para o tipo text apresentar um input do tipo text ou
textbox (conforme o tipo de campo especificado na BD)</li>
          <li>para o tipo bool apresentar um input do tipo radio<br>
          </li>
          <li>para os tipos int e double apresentar um input do tipo
text</li>
          <li>para o tipo enum apresentar um input do tipo radio,
checkbox ou selectbox (conforme o tipo de campo especificado na BD) em
que as
opções são obtidas através de uma query
à tabela prop_allowed_value</li>
          <li style="background-color: yellow;">para
o tipo ent_ref,
apresentar um input do tipo selectbox em que as opções
são obtidas através de uma query à BD para se
obter uma lista dos tuplos em entity que referenciem o id da
tabela ent_type, que seja também referenciado pelo atributo
fk_ent_type_id da propriedade que é "chave estrangeira" na entidade
selecionada para inserção de valores. O value
de cada opção será o id do tuplo de entity e o
texto a apresentar na opção será o valor no
atributo value correspondente à propriedade nome da entidade
selecionada. Por exemplo e clarificando, assumindo uma entidade chamada
<span style="font-weight: bold;">casa</span>,&nbsp; e que
por sua vez tem a property <span style="font-weight: bold;">nome</span>
(da casa). Assumindo que a entidade tv tem uma propriedade, com
value_type ent_ref e em que o valor de fk_ent_type_id=ao id da entidade <span style="font-weight: bold;">casa</span>.
Assumindo que já existem na tabela entity tuplos com valores
para os nomes de 2 casas:
"casa das terças" e "quinta do curral" (duas instâncias da entidade casa). Se queremos introduzir
informação das tvs que existem nestas duas casas, ao
estarmos no estado insercao-de-valores para a entidade tv, devem
aparecer como texto das opções os valores existentes  no
atributo value correspondente à propriedade nome da entidade selecionada, que correspondem as instancias de casa.</li>
          <li style="background-color: rgb(255, 7, 29);">FALTA MUITOS PARA MUITOS<br>
          </li>

        </ul>
        <li>o nome de cada campo será o nome especificado no
respetivo atributo do respetivo tuplo da respetiva propriedade</li>
        <li>caso a propriedade a ser mostrada tenha um tipo de unidade,
mostrar à frente do respetivo input o nome desse tipo de unidade</li>
        <li>caso seja uma propriedade obrigatória, não
permitir o avanço/validação caso não
estiver preenchido, ou seja, o avanço não é
permitido no estado validar (estado seguinte), sendo mostrada mensagem
de erro. Se o utilizador deixar um campo obrigatório em branco
no estado introdução ele pode submeter, mas no estado
validar não pode avançar.<br data-mce-bogus="1">
        </li>
      </ul>
      <li style="background-color: yellow;"><span style="font-weight: bold;">text</span> - nome para instância da entidade - (opcional)</li>
    </ul>
  </ul>
  <ul>
    <ul>
      <li><span style="font-weight: bold;">hidden</span> (estado) -
value: <span style="font-weight: bold;">validar</span></li>
    </ul>
    <ul>
      <li><span style="font-weight: bold;">submit</span> - <span style="font-style: italic;">Submeter</span></li>
    </ul>
  </ul>
  <li>Se o estado de execução é <span style="font-weight: bold;">validar</span></li>
  <ul>
    <li>Apresentar o Sub-título
(heading 3): <span style="font-style: italic;"><span style="font-weight: bold;">Inserção de valores</span></span><span style="font-style: italic;"><span style="font-weight: bold;"></span></span><span style="font-style: italic;"><span style="font-weight: bold;"> - xxx</span></span><span style="font-weight: bold; font-style: italic;"> - validar</span> <span style="text-decoration: underline;">(onde </span><span style="font-weight: bold; text-decoration: underline;">xxx</span><span style="text-decoration: underline;"> é o valor na
variável de sessão <span style="font-weight: bold;">ent</span></span><span style="font-weight: bold; text-decoration: underline;">_name</span><span style="text-decoration: underline;">)</span></li>
    <li>Caso
algum campo obrigatório não tenha sido preenchido
apresentar mensagem de erro indicando que é obrigatório o
preenchimento do campo (mostrar o nome da propriedade) e apresentar
ligação para voltar atrás.</li>
    <li>Caso contrário listar os dados inseridos pelo
utilizador
mostrando:</li>
    <li><span style="font-style: italic;">Estamos prestes a inserir
os
dados abaixo na base de dados. Confirma que os dados
estão
correctos e pretende submeter os mesmos?</span><br>
      <span style="text-decoration: underline;"></span></li>
    <ul>
      <li><span style="text-decoration: underline;">apresentar
uma
lista com os dados preenchidos no estado anterior (só para o
utilizador ler, não é possível a
edição)<br>
        </span></li>
      <li><span style="text-decoration: underline;">output
de
formulário com todos os campos preenchidos como inputs hidden
(para os dados poderem passar para o estado seguinte, outra alternativa
é usar variáveis de sessão) e,
adicionalmente:</span><br>
      </li>
    </ul>
    <ul>
      <li>o action do formulário tem o seguite formato <span style="font-weight: bold;">insercao-de-valores</span><span style="font-weight: bold;">?estado=inserir&amp;ent=e</span>" onde <span style="font-weight: bold;">e</span> é o id do entidade<br>
 </li>
    </ul>
    <ul>
      <li><span style="font-weight: bold;">submit</span> - <span style="font-style: italic;">Submeter</span><br>
      </li>
    </ul>
  </ul>
  <li>Se o estado de execução é <span style="font-weight: bold;">inserir</span><span style="font-weight: bold;"></span></li>
  <ul>
    <li>Sub-título deste estado (heading 3): <span style="font-style: italic;"><span style="font-weight: bold;">Inserção
de valores</span></span><span style="font-style: italic;"><span style="font-weight: bold;"></span></span><span style="font-style: italic;"><span style="font-weight: bold;"> - xxx</span></span><span style="font-weight: bold; font-style: italic;"> -
inserção</span> <span style="text-decoration: underline;">(onde
      </span><span style="font-weight: bold; text-decoration: underline;">xxx</span><span style="text-decoration: underline;"> é o valor na
variável de sessão <span style="font-weight: bold;">ent</span></span><span style="font-weight: bold; text-decoration: underline;">_name</span><span style="text-decoration: underline;">)</span><span style="font-style: italic;"> </span></li>
    <li>Para cada campo, obter o id da propriedade a partir do nome do
campo e construir uma string com o comando SQL necessário
para
inserção dos dados na tabela <span style="font-weight: bold;">value</span>
em que o <span style="font-weight: bold;">entity_id</span>
é o id de um tuplo previamente inserido na tabela <span style="font-weight: bold;">entity</span>, que
é um tuplo que irá "agregar" todos os valores de
propriedades inseridas relativas a uma entidade, o <span style="font-weight: bold;">property_id</span> é o id obtido
como indicado atrás, <span style="font-weight: bold;">value</span>
é o valor do
respetivo campo, <span style="font-weight: bold;">date</span> é
a data atual, <span style="font-weight: bold;">time</span> o instante
de tempo atual e <span style="font-weight: bold;">producer</span> o
user name wordpress logado</li>
    <li style="background-color: red;">FALTA RELAÇÃO<br>
    </li>

    <li>Executar os comandos SQL e apresentar, em caso de sucesso da
inserção:</li>
    <ul>
      <li><span style="font-style: italic;">Inseriu o(s) valor(es) com
sucesso.</span></li>
      <li><span style="font-style: italic;">Clique em </span><span style="font-weight: bold; font-style: italic;">Voltar</span><span style="font-style: italic;"> para voltar ao início da
inserção de valores e poder escolher outra entidade ou
em <span style="font-weight: bold;">Continuar a inserir valores nesta entidade</span> se quiser continuar a inserir valores<br>
        </span></li>
      <ul>
        <li>em que <span style="font-weight: bold; font-style: italic;">Voltar</span>
é uma ligação para a
página <span style="font-weight: bold;">insercao-de-valores</span>
e <span style="font-style: italic;"><span style="font-weight: bold;">Continuar
a inserir valores nesta entidade</span></span>
é uma ligação para o seguinte endereço: "<span style="font-weight: bold;">insercao-de-valores</span><span style="font-weight: bold;">?estado=introducao&amp;ent=e</span>" onde <span style="font-weight: bold;">e</span> é o id da entidade
guardado em sessão <br>
        </li>
      </ul>
    </ul>
  </ul>
</ul>

<h3>Pesquisa Dinâmica<br>
</h3>

Página <span style="font-weight: bold;">pesquisa-dinamica</span><br>

<ul>

  <li>Criar no Wordpress (menu Users) uma nova capability chamada <span style="font-weight: bold;">Dynamic Search</span> e activar esta
capability para o Role <span style="font-weight: bold;">Administrator</span>.</li>
  <li>Este componente, ao ser executado, faz primeiramente um teste se
foi realizado um login no Wordpress e se o utilizador com sessão
iniciada tem (independentemente do seu role) a capability <span style="font-weight: bold;">Dynamic Search</span><span style="font-weight: bold;"></span></li>
  <li>Caso não tenha, é mostrada uma mensagem a dizer
"Não tem
autorização para aceder a esta página", caso
tenha, é executado o
comportamento a seguir especificado.</li>
  <li>Se não vier nenhum
valor na variável (REQUEST) sobre o estado de
execução, apresentar o Sub-título
(heading 3): <span style="font-style: italic;"><span style="font-weight: bold;">Pesquisa Dinâmica - escolher
componente<br>
    </span></span></li>
  <ul>
    <li>Apresentar uma lista dos tipos de
componentes e componentes existentes na BD, que sejam referenciados por
pelo menos um outro componente, no atributo comp_fk_id, seguindo-se o
formato de listas do componente anterior, mas sendo o URL o seguinte: "<span style="font-weight: bold;">pesquisa-dinamica?estado=escolha&amp;comp=c</span></li>
  </ul>
  <li>Se o estado de execução é <span style="font-weight: bold;">escolha</span></li>
  
  <ul>

    
    <li>Apresentar uma lista das propriedades do componente escolhido,
sendo cada propriedade seguida por uma checkbox. As propriedades
selecionadas serão as cujos valores deverão aparecer no
resultado desta pesquisa.</li>
<li>Apresentar
também uma lista das propriedades (também seguidas por
uma checkbox) dos componentes que contenham pelo menos uma propriedade
cujo
value_type seja "comp_ref" e cujo atributo comp_fk_id referencie o
componente escolhido. Dando continuidade ao exemplo apresentado para a
inserção de valores, se o componente escolhido for casa,
além das propriedades desse próprio componente a
apresentar segundo o ponto anterior, deverão também ser
apresentadas as propriedades do componente tv, pois este tem uma
propriedade do tipo comp_ref, referenciando o componente casa<br>
</li>
    <li>Tem de ser possível restringir a lista de
instâncias do
componente escolhido com um conjunto de critérios aplicados
às propriedades escolhidas (tanto do componente escolhido como
dos eventuais componentes que o referem), sendo
que deve ser dada ao utilizador a capacidade de escolher trios
de:&nbsp; propriedade, operador e valor. Por ex, se o componente
escolhido for <span style="font-weight: bold;">casa</span>
e ele tiver propriedades: nome (nota: deve ser possível deixar
os trios com escolha vazia, caso em que não é aplicado
filtro - neste exemplo deve ser possível mostrar casas com
qualquer nome) e tipologia (do tipo enum, com valores permitidos:
vivenda, mansão, apartamento, geminada),
podemos ter os seguintes 3 trios numa pesquisa: nome (deixar vazio para
mostrar qualquer casa), tipologia = vivenda (para mostrar só
instâncias de vivenda), diagonal &lt; 50;
tecnologia 3D = ativa; resolução = Ultra HD</li>

  
  </ul>

  <li>Se o estado é <span style="font-weight: bold;">execucao</span>,
a
ser invocado depois de escolhido o conjunto de trios, é
construída dinamicamente uma query SQL que executa a pesquisa
construída e faz output para o utilizador.</li>
  <li>Notas:</li>
  <ul>
    <li>este componente deve ser totalmente dinâmico indo buscar
num array no ficheiro common.php a lista de operadores disponíves</li>
    <li>a nível de usabilidade, para facilitar a escolha da
propriedade uma hipótese é fazer output de uma
árvore do género da que é feita no componente
inserção de valores, mas que além dos tipos de
componente, e componente mostra també as propriedades de cada
componente.</li>
    <li>quando o utilizador escolhe uma propriedade os valores devem
ser restringidos de acordo com o seu tipo. Por exemplo, se for enum
aparece uma lista dos valores permitidos. Se for double permite inserir
um número real</li>
    <li>considerar os 4 operadores: &gt; = &lt; !=<span style="font-weight: bold;"></span></li>
  </ul>
  <li><span style="font-weight: bold;">Exportação de
valores</span></li>
  <ul>
    <li>Dar a capacidade de ser possível
exportar os resultados das pesquisas dinâmicas para um ficheiro
Excel, usando-se biblioteca PHP que permita a geração e
download do respetivo fichero excel, com a tabela dos resultados. A
primeira linha do ficheiro excel deverá conter uma frase gerada
automaticamente (a partir das propriedades e trios acima escolhidos)
"descrevendo" a query. A segunda linha deve conter o cabeçalho
com os nomes em form-field-name, a terceira linha os nomes em si das
propriedades. As linhas seguintes os valores.<br>
    </li>
  </ul>
</ul>

<h3>Importação de Valores<br>
</h3>

Página importacao-de-valores<br>

<ul>

  <li>Criar no Wordpress (menu Users) uma nova capability chamada <span style="font-weight: bold;">Values Import</span> e activar esta
capability para o Role <span style="font-weight: bold;">Administrator</span>.</li>
  <li>Este componente, ao ser executado, faz primeiramente um teste se
foi realizado um login no Wordpress e se o utilizador com sessão
iniciada tem (independentemente do seu role) a capability <span style="font-weight: bold;">Values Import</span><span style="font-weight: bold;"></span></li>
  <li>Caso não tenha, é mostrada uma mensagem a dizer
"Não tem
autorização para aceder a esta página", caso
tenha, é executado o
comportamento a seguir especificado.</li>
  <li>Se não vier nenhum
valor na variável (REQUEST) sobre o estado de
execução, apresentar o Sub-título
(heading 3): <span style="font-style: italic;"><span style="font-weight: bold;">Importação de Valores -
escolher componente<br>
    </span></span></li>
  <ul>
    <li>Apresentar uma lista dos tipos de componentes e componentes
existentes na BD, seguindo-se o seguinte formato:</li>
    <li>Componentes:<br>
    </li>
    <ul>
      <li>propriedade&nbsp;&nbsp; <br>
      </li>
      <ul>
        <li>[entidade a faturar]</li>
        <li>[serviços contratados]</li>
        <li>[áreas]</li>
        <li>[tv]</li>
      </ul>
      <li>canal de venda</li>
      <ul>
        <li>[nome]</li>
        <li>[custos]</li>
        <li>[comissão]<br>
        </li>
      </ul>
    </ul>
    <ul>
      <ul>
        <li>...</li>
      </ul>
    </ul>
    <li>Formulários customizados</li>
    <ul>
      <li>[Form 1]</li>
      <li>[Form 2]</li>
      <li>...<br>
      </li>
    </ul>
    <li>Nota: as listas são construídas dinamicamente
graças às queries necessárias à BD, que
vão buscar os nomes na tabela <span style="font-weight: bold;">comp_type</span>
(entradas de nível superior) e <span style="font-weight: bold;">component</span>
- que aparecem listados entre parêntesis retos, e em que cada
item é uma ligação para o seguinte
endereço: "<span style="font-weight: bold;">importacao-de-valores?estado=introducao&amp;comp=c</span>"
onde <span style="font-weight: bold;">c</span> é o id <span style="font-weight: bold;"></span>do respetivo componente nessa
entrada ou "<span style="font-weight: bold;">importacao-de-valores?estado=introducao&amp;form=f</span>"
onde <span style="font-weight: bold;">f</span> é o id <span style="font-weight: bold;"></span>do respetivo form customizado </li>
    <li>Se o estado de execução é <span style="font-weight: bold;">introducao</span></li>
    <ul>
      <li>Apresentar uma tabela com duas linhas, contendo, na primeira,
em cada coluna os formfieldnames das
propriedades do componente ou formulário clicado. Para o caso de
propriedades do tipo enum, repetir nesta linha o nome deste campo o
número de vezes igual ao total de valores permitidos. Na segunda
linha, apresentar, apenas para as propriedades enum, nas respetivas
colunas os valores permitidos. Por baixo desta tabela indicar ao
utilizador que deverá copiar estas linhas para um ficheiro excel
e introduzir os valores a importar, sendo que no caso das propriedades
enum, deverá constar um 0 quando esse valor permitido não
se aplique à instância em causa e um 1 quando esse valor
se aplica.</li>
      <li>Por baixo da tabela deve constar um campo para upload do
ficheiro excel sendo o próximo estado <span style="font-weight: bold;">insercao</span>.</li>
    </ul>
    <li>Se o estado de execução é <span style="font-weight: bold;">insercao</span>:</li>
    <ul>
      <li>processar o ficheiro recebido e realizar inserts na BD sendo
que cada linha do excel irá corresponder a uma instância
(tuplo em comp_inst e tuplos em value necessários) do componente
selecionado.</li>
    </ul>
  </ul>
</ul>

<ul>

</ul>


</body></html>